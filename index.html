<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#A2AE83">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Hazel">
    <title>Hazel - Mental Health Support</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkhhemVsIC0gTWVudGFsIEhlYWx0aCBTdXBwb3J0IiwKICAic2hvcnRfbmFtZSI6ICJIYXplbCIsCiAgImRlc2NyaXB0aW9uIjogIk1lbnRhbCBoZWFsdGggc3VwcG9ydCBhcHAgd2l0aCBqb3VybmFsaW5nLCByZXNvdXJjZXMsIGFuZCBjcmlzaXMgc3VwcG9ydCIsCiAgInN0YXJ0X3VybCI6ICIvIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjQTJBRTgzIiwKICAidGhlbWVfY29sb3IiOiAiI0EyQUU4MyIsCiAgIm9yaWVudGF0aW9uIjogInBvcnRyYWl0LXByaW1hcnkiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSTFNVEp3ZUNJZ2FHVnBaMmgwUFNJMU1USndjQ0lnZG1sbGQwSnZlRDBpTUNBd0lEVXhNaUExTVRKY0lqNDhjR0YwYUNCbWFXeHNQU0lqTlRVMlFqSm1JaUJrUFNKTk1qVXNNakJETXpBc01qQm5NakFzTkRCbk1qQXNOakJETWpBc09EQm5NekFzT1RCbk5UQXNPVEJEZERBc09UQm5PREFTLE9EQW5PREREQ0p6QXNOREJuTnpBc01qQm5OVEFzTWpaQU9UQXNOVk5QVFRNeE5Dd3dkMFJETXpFMExqQXNPREJRWXpZNExqSXNOREJuTmpZc05EQW5OVFl1T0hNdE1qY3VORFF0TURJME1VMDZORFV0TURREUF3UXpOVEFzTkRJZ016VTVRemt1TXpVdU9EbGNJaTQ4TDNCaGRHZCtQQzl6ZG1jKyIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0l5TkRCd2VDSWdhR1ZwWjJoMFBTSXlOREJ3ZUNJZ2RtbGxkMEp2ZUQwaU1DQXdJREkwTUNBeU5EQmNJajQ4Y0dGMGFDQm1hV3hzUFNJak5UVTJRakptSWlCa1BTSk5NVElzTWxZRE1UQXNNaUF5TERJNUlETXNNamtnTWl3ek15QXlMRE16SUMwekxqWTVMRE16TFRJdU5pMDBMalk1TFRndU15MDBMall4TFRJME9VMDJMVEV4UVRjMUxqUXNOVGM1TGpRMElFMDBPVGMwTGpJN0lDMDBNMnhNTVRBNE1Ta3lNalE5T0RJME5Ta3lPVE09SWo0OEwzQmhkR2crUEM5emRtYyssPGEKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIsCiAgICAgICJzaXplcyI6ICIyNDB4MjQwIgogICAgfQogIF0sCiAgInNob3J0Y3V0cyI6IFsKICAgIHsKICAgICAgIm5hbWUiOiAiTmV3IEpvdXJuYWwgRW50cnkiLAogICAgICAic2hvcnRfbmFtZSI6ICJKb3VybmFsIiwKICAgICAgInVybCI6ICIvP2FjdGlvbj1uZXctam91cm5hbCIKICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkNyaXNpcyBTdXBwb3J0IiwKICAgICAgInNob3J0X25hbWUiOiAiQ3Jpc2lzIiwKICAgICAgInVybCI6ICIvP2FjdGlvbj1jcmlzaXMiCiAgICB9CiAgXQp9">
    
    <style>
        /* CSS Custom Properties for Mobile-First Design */
        :root {
            /* Color System */
            --primary-color: #A2AE83;
            --primary-dark: #8B956C;
            --primary-light: #B8C19D;
            --secondary-color: #B088F9;
            --accent-color: #BA6464;
            --background-color: #A2AE83;
            --surface-color: #FFFFFF;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-on-primary: #FFFFFF;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --error-color: #F44336;
            
            /* Fluid Typography */
            --text-xs: clamp(0.75rem, 1.5vw + 0.5rem, 0.875rem);
            --text-sm: clamp(0.875rem, 2vw + 0.5rem, 1rem);
            --text-base: clamp(1rem, 2.5vw + 0.5rem, 1.125rem);
            --text-lg: clamp(1.125rem, 3vw + 0.5rem, 1.25rem);
            --text-xl: clamp(1.25rem, 4vw + 0.5rem, 1.5rem);
            --text-2xl: clamp(1.5rem, 5vw + 0.5rem, 2rem);
            --text-3xl: clamp(2rem, 6vw + 0.5rem, 3rem);
            --text-4xl: clamp(2.5rem, 8vw + 0.5rem, 4rem);
            
            /* Responsive Spacing */
            --space-xs: clamp(0.25rem, 1vw, 0.5rem);
            --space-sm: clamp(0.5rem, 2vw, 1rem);
            --space-md: clamp(1rem, 3vw, 1.5rem);
            --space-lg: clamp(1.5rem, 4vw, 2rem);
            --space-xl: clamp(2rem, 5vw, 3rem);
            --space-2xl: clamp(3rem, 6vw, 4rem);
            
            /* Border Radius */
            --radius-sm: 0.5rem;
            --radius-md: 1rem;
            --radius-lg: 1.5rem;
            --radius-xl: 2rem;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.1);
            
            /* Z-index Scale */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            
            /* Safe Areas */
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-right: env(safe-area-inset-right);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
            --safe-area-inset-left: env(safe-area-inset-left);
        }

        /* Reset and Base Styles */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
            -moz-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            min-height: 100dvh;
            padding-top: var(--safe-area-inset-top);
            padding-left: var(--safe-area-inset-left);
            padding-right: var(--safe-area-inset-right);
            font-size: var(--text-base);
        }

        /* Enhanced Container System */
        .container {
            width: 100%;
            max-width: 100vw;
            min-height: calc(100vh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
            min-height: calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
            position: relative;
            padding-bottom: calc(90px + var(--safe-area-inset-bottom));
        }

        /* Mobile-First Navigation Bar */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            padding: var(--space-sm) 0;
            padding-bottom: calc(var(--space-sm) + var(--safe-area-inset-bottom));
            box-shadow: 0 -2px 20px rgba(0,0,0,0.1);
            z-index: var(--z-fixed);
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-sm);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: var(--radius-sm);
            margin: 0 var(--space-xs);
            min-height: 44px;
            text-decoration: none;
            color: inherit;
            position: relative;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 50%;
            width: 20px;
            height: 3px;
            background: var(--primary-color);
            border-radius: 2px;
            transform: translateX(-50%) scaleX(0);
            transition: transform 0.2s ease;
        }

        .nav-item.active::before {
            transform: translateX(-50%) scaleX(1);
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        .nav-icon {
            font-size: 1.5rem;
            margin-bottom: var(--space-xs);
            transition: transform 0.2s ease;
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        .nav-text {
            font-size: var(--text-xs);
            font-weight: 600;
            text-align: center;
        }

        /* Enhanced Page System */
        .page {
            display: none;
            padding: var(--space-lg);
            min-height: calc(100vh - 100px);
            min-height: calc(100dvh - 100px);
            width: 100%;
            overflow-x: hidden;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Home Page Styles */
        .home-header {
            text-align: center;
            margin-bottom: var(--space-xl);
        }

        .logo {
            width: clamp(80px, 20vw, 120px);
            height: clamp(80px, 20vw, 120px);
            background: linear-gradient(135deg, #556B2F, #6B7F3F);
            border-radius: var(--radius-lg);
            margin: 0 auto var(--space-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(2rem, 8vw, 3rem);
            color: white;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .logo::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            transform: rotate(45deg);
            animation: logoShine 3s ease-in-out infinite;
        }

        @keyframes logoShine {
            0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .feeling-text {
            font-size: var(--text-xl);
            font-weight: 700;
            margin-bottom: var(--space-lg);
            color: var(--text-primary);
        }

        /* Enhanced Emoji Container */
        .emoji-container {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            margin: var(--space-lg) 0;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: var(--space-sm);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .emoji-btn {
            font-size: clamp(2rem, 6vw, 2.5rem);
            background: none;
            border: none;
            cursor: pointer;
            padding: var(--space-md);
            border-radius: 50%;
            transition: all 0.2s ease;
            min-height: 60px;
            min-width: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .emoji-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary-color);
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
            border-radius: 50%;
        }

        .emoji-btn:hover::before,
        .emoji-btn:focus::before {
            opacity: 0.1;
            transform: scale(1);
        }

        .emoji-btn:active {
            transform: scale(0.95);
        }

        /* Enhanced Sobriety Tracker */
        .sobriety-tracker {
            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(0,0,0,0.6));
            color: white;
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            margin: var(--space-lg) 0;
            position: relative;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .sobriety-tracker::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.05) 50%, transparent 70%);
            pointer-events: none;
        }

        .sobriety-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            position: relative;
            z-index: 1;
        }

        .sobriety-title {
            font-size: var(--text-lg);
            font-weight: 700;
        }

        .edit-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: var(--text-lg);
            cursor: pointer;
            padding: var(--space-sm);
            border-radius: 50%;
            min-height: 44px;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .edit-btn:hover,
        .edit-btn:focus {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .days-counter {
            text-align: center;
            margin-bottom: var(--space-lg);
            position: relative;
            z-index: 1;
        }

        .days-number {
            font-size: var(--text-4xl);
            font-weight: 900;
            margin-bottom: var(--space-xs);
            background: linear-gradient(45deg, #ffffff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(255,255,255,0.3);
        }

        .days-text {
            font-size: var(--text-lg);
            opacity: 0.9;
        }

        .motivation-text {
            text-align: center;
            margin-bottom: var(--space-lg);
            font-size: var(--text-base);
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        .progress-container {
            margin-bottom: var(--space-lg);
            position: relative;
            z-index: 1;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: var(--space-sm);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-light));
            border-radius: 4px;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShine 2s ease-in-out infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .milestone-text {
            text-align: center;
            font-size: var(--text-sm);
            opacity: 0.8;
        }

        /* Enhanced Button System */
        .btn {
            padding: var(--space-md) var(--space-xl);
            border: none;
            border-radius: var(--radius-full);
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            position: relative;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: var(--text-on-primary);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover,
        .btn-primary:focus {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--accent-color), #A54343);
            color: var(--text-on-primary);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--surface-color);
            color: var(--text-primary);
            border: 2px solid var(--primary-color);
        }

        .reset-btn, .hotlines-btn {
            background: linear-gradient(135deg, var(--accent-color), #A54343);
            color: white;
            border: none;
            padding: var(--space-lg) var(--space-2xl);
            border-radius: var(--radius-full);
            font-size: var(--text-lg);
            font-weight: 700;
            cursor: pointer;
            display: block;
            margin: var(--space-lg) auto;
            transition: all 0.2s ease;
            min-height: 56px;
            box-shadow: var(--shadow-md);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .reset-btn:hover,
        .reset-btn:focus,
        .hotlines-btn:hover,
        .hotlines-btn:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .loved-text {
            text-align: center;
            font-size: var(--text-lg);
            margin: var(--space-lg) 0;
            color: var(--text-primary);
            font-weight: 500;
        }

        .streak-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-xs);
            margin-top: var(--space-lg);
            flex-wrap: wrap;
        }

        .heart, .hazelnut {
            font-size: 1.5rem;
            animation: heartbeat 2s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 50%, 100% { transform: scale(1); }
            25%, 75% { transform: scale(1.1); }
        }

        /* Enhanced Modal System */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            z-index: var(--z-modal);
            backdrop-filter: blur(4px);
            padding: var(--space-lg);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--background-color);
            padding: var(--space-xl);
            border-radius: var(--radius-xl);
            max-width: min(90vw, 400px);
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            transform: translateY(0);
            animation: modalSlideIn 0.3s ease;
            width: 100%;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Support Panel */
        .support-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            padding: var(--space-2xl);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            z-index: var(--z-modal);
            display: none;
            max-width: min(90vw, 320px);
            width: 100%;
            backdrop-filter: blur(10px);
        }

        .support-panel.show {
            display: block;
            animation: supportPanelSlideIn 0.3s ease;
        }

        @keyframes supportPanelSlideIn {
            from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .support-panel h3 {
            color: white;
            text-align: center;
            margin-bottom: var(--space-lg);
            font-size: var(--text-lg);
            font-weight: 600;
        }

        .support-btn {
            display: block;
            width: 100%;
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            border: none;
            border-radius: var(--radius-full);
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 48px;
            position: relative;
            overflow: hidden;
        }

        .support-btn.primary {
            background: var(--secondary-color);
            color: white;
        }

        .support-btn.danger {
            background: var(--accent-color);
            color: white;
        }

        .support-btn.secondary {
            background: white;
            color: var(--text-primary);
        }

        /* Journal Styles */
        .journal-header {
            text-align: center;
            margin-bottom: var(--space-xl);
        }

        .journal-title {
            font-size: var(--text-3xl);
            font-weight: 700;
            color: #435334;
            margin-bottom: var(--space-lg);
        }

        .new-entry-btn {
            background: var(--surface-color);
            color: #435334;
            border: none;
            padding: var(--space-lg) var(--space-xl);
            border-radius: var(--radius-full);
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: var(--space-lg) 0;
            min-height: 48px;
            box-shadow: var(--shadow-md);
            transition: all 0.2s ease;
        }

        .new-entry-btn:hover,
        .new-entry-btn:focus {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .journal-entries {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .journal-entry {
            background: var(--surface-color);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .journal-entry::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-color);
        }

        .journal-entry:hover,
        .journal-entry:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .entry-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: #435334;
            margin-bottom: var(--space-xs);
        }

        .entry-date {
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        .entry-mood {
            position: absolute;
            top: var(--space-md);
            right: var(--space-md);
            font-size: 1.2rem;
        }

        .empty-state {
            text-align: center;
            color: var(--text-secondary);
            font-style: italic;
            margin: var(--space-2xl) 0;
            padding: var(--space-xl);
            background: rgba(255,255,255,0.5);
            border-radius: var(--radius-lg);
        }

        /* Enhanced Dashboard Layout */
        .dashboard-container {
            display: flex;
            height: calc(100vh - 140px);
            height: calc(100dvh - 140px);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .tab-sidebar {
            width: 80px;
            background: #000;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .tab-item {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            font-size: var(--text-xs);
            font-weight: 700;
            text-align: center;
            line-height: 1.2;
            transition: all 0.2s ease;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            padding: var(--space-sm);
            position: relative;
            min-height: 60px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .tab-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--primary-color);
            transform: scaleY(0);
            transition: transform 0.2s ease;
        }

        .tab-item.active::before {
            transform: scaleY(1);
        }

        .tab-item:nth-child(1) { background: #FFFFFF; color: #000; }
        .tab-item:nth-child(2) { background: #8FAE79; }
        .tab-item:nth-child(3) { background: #678553; }
        .tab-item:nth-child(4) { background: #45582F; }

        .tab-content {
            flex: 1;
            background: #A9B189;
            padding: var(--space-lg);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .section-title {
            color: white;
            font-size: var(--text-xl);
            font-weight: 700;
            text-align: center;
            margin-bottom: var(--space-sm);
        }

        .section-divider {
            height: 1px;
            background: white;
            margin-bottom: var(--space-lg);
            opacity: 0.7;
        }

        .alternatives-list {
            color: white;
            line-height: 1.8;
            margin-bottom: var(--space-xl);
            font-size: var(--text-base);
        }

        .resource-btn {
            display: block;
            width: 100%;
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            background: #C2ABF9;
            color: #000;
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 48px;
        }

        .resource-btn:hover,
        .resource-btn:focus {
            background: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Menu Categories */
        .menu-categories {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        .menu-category {
            background: var(--surface-color);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--space-md);
            transition: all 0.2s ease;
        }

        .menu-category:hover,
        .menu-category:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .category-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-color);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .category-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--text-primary);
        }

        /* To-Do List Styles */
        .todo-container {
            max-width: 100%;
        }

        .todo-title {
            font-size: var(--text-3xl);
            font-weight: 700;
            color: white;
            text-align: center;
            margin-bottom: var(--space-xl);
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .add-task-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
            display: flex;
            gap: var(--space-md);
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .task-input {
            flex: 1;
            background: none;
            border: none;
            color: white;
            font-size: var(--text-base);
            padding: var(--space-md);
            outline: none;
            border-radius: var(--radius-md);
            background: rgba(255,255,255,0.1);
        }

        .task-input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .add-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 44px;
        }

        .add-btn:hover,
        .add-btn:focus {
            background: #9966E6;
            transform: scale(1.05);
        }

        .tasks-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            color: white;
            backdrop-filter: blur(10px);
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md) 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            transition: all 0.2s ease;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .task-checkbox.completed {
            background: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .task-checkbox.completed::after {
            content: '✓';
            color: white;
            font-size: 14px;
        }

        .task-text {
            flex: 1;
            transition: all 0.3s ease;
            font-size: var(--text-base);
        }

        .task-text.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        /* Form Styles */
        .entry-form {
            background: var(--surface-color);
            padding: var(--space-xl);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-lg);
            box-shadow: var(--shadow-md);
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #435334;
            margin-bottom: var(--space-sm);
            font-size: var(--text-base);
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: var(--space-md);
            border: 2px solid #ddd;
            border-radius: var(--radius-md);
            font-size: var(--text-base);
            transition: border-color 0.2s ease;
            font-family: inherit;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .mood-selector {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: var(--space-sm);
            margin-top: var(--space-sm);
        }

        .mood-btn {
            font-size: 2rem;
            background: rgba(0,0,0,0.05);
            border: 2px solid transparent;
            cursor: pointer;
            padding: var(--space-md);
            border-radius: 50%;
            opacity: 0.5;
            transition: all 0.3s ease;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60px;
        }

        .mood-btn.selected {
            opacity: 1;
            border-color: var(--primary-color);
            background: rgba(162, 174, 131, 0.1);
            transform: scale(1.1);
        }

        .form-actions {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-xl);
        }

        /* Hotline Cards */
        .hotline-card {
            background: var(--surface-color);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-md);
            box-shadow: var(--shadow-md);
        }

        .hotline-title {
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--space-md);
        }

        .hotline-actions {
            display: flex;
            gap: var(--space-sm);
        }

        .hotline-call, .hotline-info {
            flex: 1;
            padding: var(--space-md);
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 44px;
        }

        .hotline-call {
            background: #A54343;
            color: white;
        }

        .hotline-info {
            background: #5A6E3A;
            color: white;
        }

        .close-modal {
            background: #333;
            color: white;
            padding: var(--space-lg);
            border: none;
            border-radius: var(--radius-md);
            width: 100%;
            margin-top: var(--space-lg);
            cursor: pointer;
            font-size: var(--text-base);
            font-weight: 600;
            min-height: 48px;
        }

        /* Emergency Button */
        .emergency-btn {
            position: fixed;
            top: calc(20px + var(--safe-area-inset-top));
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            z-index: var(--z-tooltip);
            box-shadow: 0 4px 12px rgba(255, 68, 68, 0.4);
            transition: all 0.2s ease;
            display: none;
            animation: pulse 2s infinite;
        }

        .emergency-btn.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes pulse {
            0% { box-shadow: 0 4px 12px rgba(255, 68, 68, 0.4); }
            50% { box-shadow: 0 4px 20px rgba(255, 68, 68, 0.8); }
            100% { box-shadow: 0 4px 12px rgba(255, 68, 68, 0.4); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
                height: auto;
                min-height: calc(100vh - 140px);
                min-height: calc(100dvh - 140px);
            }
            
            .tab-sidebar {
                width: 100%;
                height: 60px;
                flex-direction: row;
                order: 2;
            }
            
            .tab-item {
                writing-mode: horizontal-tb;
                text-orientation: initial;
                font-size: var(--text-xs);
                min-height: 60px;
            }
            
            .tab-content {
                order: 1;
                min-height: 300px;
            }
            
            .tab-item::before {
                left: 0;
                right: 0;
                top: 0;
                bottom: auto;
                width: auto;
                height: 3px;
                transform: scaleX(0);
            }
            
            .tab-item.active::before {
                transform: scaleX(1);
            }

            .form-actions {
                flex-direction: column;
            }

            .hotline-actions {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .page {
                padding: var(--space-md);
            }
            
            .emoji-container {
                padding: var(--space-md);
                gap: var(--space-xs);
            }
            
            .emoji-btn {
                min-height: 50px;
                min-width: 50px;
                font-size: clamp(1.5rem, 5vw, 2rem);
                padding: var(--space-sm);
            }
            
            .sobriety-tracker {
                padding: var(--space-lg);
            }
        }

        /* Accessibility */
        .nav-item:focus,
        .emoji-btn:focus,
        .btn:focus,
        .edit-btn:focus,
        .task-checkbox:focus,
        .mood-btn:focus {
            outline: 3px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Touch feedback for mobile */
        @media (hover: none) and (pointer: coarse) {
            .nav-item:active,
            .emoji-btn:active,
            .btn:active,
            .task-checkbox:active,
            .mood-btn:active {
                transform: scale(0.98);
            }
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            .nav-item.active {
                background: var(--primary-color);
                color: white;
            }
            
            .btn {
                border: 2px solid currentColor;
            }
        }

        /* Loading state */
        .loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Emergency Button -->
        <button id="emergencyBtn" class="emergency-btn" aria-label="Emergency crisis support">🆘</button>

        <!-- Home Page -->
        <div id="home" class="page active">
            <div class="home-header">
                <div class="logo">🌰</div>
                <div class="feeling-text">How are you feeling?</div>
                <div class="emoji-container">
                    <button class="emoji-btn" data-mood="very-sad" aria-label="Very sad">😢</button>
                    <button class="emoji-btn" data-mood="sad" aria-label="Sad">😔</button>
                    <button class="emoji-btn" data-mood="neutral" aria-label="Neutral">😐</button>
                    <button class="emoji-btn" data-mood="happy" aria-label="Happy">😊</button>
                    <button class="emoji-btn" data-mood="very-happy" aria-label="Very happy">😄</button>
                </div>

                <!-- Sobriety Tracker -->
                <div class="sobriety-tracker">
                    <div class="sobriety-header">
                        <div class="sobriety-title">Sobriety Tracker</div>
                        <button class="edit-btn" id="editSobrietyBtn" aria-label="Edit sobriety date">✏️</button>
                    </div>
                    <div class="days-counter">
                        <div class="days-number" id="sobrietyDays">0</div>
                        <div class="days-text">days</div>
                    </div>
                    <div class="motivation-text" id="motivationText">
                        Every day is a victory! Your journey starts now.
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                        <div class="milestone-text" id="milestoneText">Next milestone: 1 week</div>
                    </div>
                    <button class="reset-btn" id="resetBtn">RESET</button>
                </div>

                <div class="loved-text">You are loved ❤️</div>
                <button class="hotlines-btn" id="hotlinesBtn">HOTLINES</button>
                <div class="streak-container" id="streakContainer">
                    <!-- Hearts will be added dynamically -->
                </div>
            </div>
        </div>

        <!-- Journal Page -->
        <div id="journal" class="page">
            <div class="journal-header">
                <div class="journal-title">Journal</div>
                <button class="new-entry-btn" id="newEntryBtn">New entry</button>
            </div>
            <div id="journalEntries" class="journal-entries">
                <div class="empty-state">No journal entries yet. Start writing to track your thoughts and feelings.</div>
            </div>
        </div>

        <!-- Dashboard/Resources Page -->
        <div id="dashboard" class="page">
            <div class="dashboard-container">
                <div class="tab-sidebar">
                    <div class="tab-item active" data-tab="self-harm">SELF HARM</div>
                    <div class="tab-item" data-tab="ed">ED</div>
                    <div class="tab-item" data-tab="anxiety">ANXIETY</div>
                    <div class="tab-item" data-tab="depression">GENERAL</div>
                </div>
                <div class="tab-content" id="tabContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Menus Page -->
        <div id="menus" class="page">
            <h2 style="text-align: center; margin-bottom: var(--space-lg); font-size: var(--text-2xl); font-weight: 700;">Food Menus</h2>
            <div class="menu-categories">
                <div class="menu-category" data-category="breakfast">
                    <div class="category-icon">🥞</div>
                    <div class="category-title">Breakfasts</div>
                </div>
                <div class="menu-category" data-category="lunch">
                    <div class="category-icon">🥗</div>
                    <div class="category-title">Lunches</div>
                </div>
                <div class="menu-category" data-category="dinner">
                    <div class="category-icon">🍽️</div>
                    <div class="category-title">Dinners</div>
                </div>
                <div class="menu-category" data-category="snacks">
                    <div class="category-icon">🍪</div>
                    <div class="category-title">Snacks</div>
                </div>
            </div>
        </div>

        <!-- To-Do List Page -->
        <div id="todo" class="page">
            <div class="todo-container">
                <div class="todo-title">To-Do List</div>
                
                <div class="add-task-container">
                    <input type="text" id="taskInput" class="task-input" placeholder="Add a new task..." maxlength="100" autocomplete="off">
                    <button class="add-btn" id="addTaskBtn">ADD</button>
                </div>

                <div class="tasks-container" id="tasksContainer">
                    <div style="text-align: center; opacity: 0.7; padding: var(--space-xl);">No tasks yet. Add one above!</div>
                </div>
            </div>
        </div>

        <!-- Support Panel -->
        <div id="supportPanel" class="support-panel">
            <h3>It's ok to need support ❤</h3>
            <button class="support-btn primary" data-action="journal">Journal</button>
            <button class="support-btn danger" data-action="hotlines">Hotlines</button>
            <button class="support-btn primary" data-action="dashboard">Resources</button>
            <button class="support-btn secondary" data-action="close">I'm okay</button>
        </div>

        <!-- Hotlines Modal -->
        <div id="hotlinesModal" class="modal">
            <div class="modal-content">
                <h2 style="color: white; text-align: center; margin-bottom: var(--space-lg); font-size: var(--text-3xl);">Hotlines</h2>
                
                <div class="hotline-card">
                    <div class="hotline-title">Emergency Numbers</div>
                    <div class="hotline-actions">
                        <button class="hotline-call" data-number="112">Ireland (112)</button>
                        <button class="hotline-call" data-number="911">America (911)</button>
                    </div>
                </div>

                <div class="hotline-card">
                    <div class="hotline-title">Childline</div>
                    <div class="hotline-actions">
                        <button class="hotline-call" data-number="1800666666">CALL NOW</button>
                        <button class="hotline-info" data-url="https://childline.ie">More Info</button>
                    </div>
                </div>

                <div class="hotline-card">
                    <div class="hotline-title">Spunout</div>
                    <div class="hotline-actions">
                        <button class="hotline-call" data-number="1800789012">CALL NOW</button>
                        <button class="hotline-info" data-url="https://spunout.ie">More Info</button>
                    </div>
                </div>

                <div class="hotline-card">
                    <div class="hotline-title">BodyWhys</div>
                    <div class="hotline-actions">
                        <button class="hotline-call" data-number="1800345678">CALL NOW</button>
                        <button class="hotline-info" data-url="https://bodywhys.ie">More Info</button>
                    </div>
                </div>

                <div class="hotline-card">
                    <div class="hotline-title">Pieta House</div>
                    <div class="hotline-actions">
                        <button class="hotline-call" data-number="1800901234">CALL NOW</button>
                        <button class="hotline-info" data-url="https://www.pieta.ie/how-we-can-help">More Info</button>
                    </div>
                </div>

                <button class="close-modal" id="closeModalBtn">Back</button>
            </div>
        </div>

        <!-- Navigation Bar -->
        <nav class="nav-bar" role="navigation" aria-label="Main navigation">
            <div class="nav-item" data-page="menus" role="tab" aria-label="Food menus">
                <div class="nav-icon">🍕</div>
                <div class="nav-text">Menus</div>
            </div>
            <div class="nav-item" data-page="dashboard" role="tab" aria-label="Mental health resources">
                <div class="nav-icon">📊</div>
                <div class="nav-text">Resources</div>
            </div>
            <div class="nav-item active" data-page="home" role="tab" aria-label="Home page">
                <div class="nav-icon">🏠</div>
                <div class="nav-text">Home</div>
            </div>
            <div class="nav-item" data-page="journal" role="tab" aria-label="Journal entries">
                <div class="nav-icon">📖</div>
                <div class="nav-text">Journal</div>
            </div>
            <div class="nav-item" data-page="todo" role="tab" aria-label="To-do list">
                <div class="nav-icon">✅</div>
                <div class="nav-text">To-Do</div>
            </div>
        </nav>
    </div>

    <script>
        // Enhanced PWA App with Mobile-First Features
        class HazelApp {
            constructor() {
                this.currentPage = 'home';
                this.journalEntries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
                this.streak = parseInt(localStorage.getItem('streak') || '0');
                this.lastLoginDate = localStorage.getItem('lastLoginDate');
                this.sobrietyStartDate = localStorage.getItem('sobrietyStartDate');
                this.tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
                this.nextTaskId = parseInt(localStorage.getItem('nextTaskId') || '1');
                this.selectedMood = null;
                this.isEditingEntry = false;
                this.editingEntryId = null;

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.setupTouchEnhancements();
                this.setupPWA();
                this.updateStreak();
                this.loadJournalEntries();
                this.showTabContent('self-harm');
                this.updateSobrietyDisplay();
                this.loadTasks();
                this.initSobrietyTracker();
                this.setupAccessibility();
                this.setupEmergencyButton();
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        this.navigateTo(item.dataset.page);
                        this.addHapticFeedback();
                    });
                });

                // Mood selection
                document.querySelectorAll('.emoji-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.handleMoodSelect(btn.dataset.mood);
                        this.addHapticFeedback();
                    });
                });

                // Support panel
                document.querySelectorAll('.support-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.handleSupportAction(btn.dataset.action);
                    });
                });

                // Dashboard tabs
                document.querySelectorAll('.tab-item').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        this.showTabContent(tab.dataset.tab);
                        this.addHapticFeedback();
                    });
                });

                // Journal
                document.getElementById('newEntryBtn').addEventListener('click', () => {
                    this.showNewEntryForm();
                });

                // Sobriety tracker
                document.getElementById('editSobrietyBtn').addEventListener('click', () => {
                    this.editSobrietyDate();
                });

                document.getElementById('resetBtn').addEventListener('click', () => {
                    this.confirmSobrietyReset();
                });

                // Hotlines
                document.getElementById('hotlinesBtn').addEventListener('click', () => {
                    this.showHotlines();
                });

                document.getElementById('closeModalBtn').addEventListener('click', () => {
                    this.hideHotlines();
                });

                document.querySelectorAll('.hotline-call').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.callNumber(btn.dataset.number);
                    });
                });

                document.querySelectorAll('.hotline-info').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.openLink(btn.dataset.url);
                    });
                });

                // Tasks
                document.getElementById('addTaskBtn').addEventListener('click', () => {
                    this.addTask();
                });

                document.getElementById('taskInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.addTask();
                    }
                });

                // Menu categories
                document.querySelectorAll('.menu-category').forEach(category => {
                    category.addEventListener('click', () => {
                        this.showRecipes(category.dataset.category);
                    });
                });

                // Emergency button
                document.getElementById('emergencyBtn').addEventListener('click', () => {
                    this.showCrisisOptions();
                });

                // Close modals on backdrop click
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.classList.remove('show');
                        }
                    });
                });
            }

            setupTouchEnhancements() {
                // Add touch feedback to interactive elements
                const interactiveElements = document.querySelectorAll('.nav-item, .emoji-btn, .btn, .edit-btn, .support-btn, .hotline-call, .hotline-info');
                
                interactiveElements.forEach(element => {
                    element.addEventListener('touchstart', (e) => {
                        element.style.transform = 'scale(0.98)';
                        this.addHapticFeedback();
                    }, { passive: true });
                    
                    element.addEventListener('touchend', (e) => {
                        element.style.transform = '';
                    }, { passive: true });
                    
                    element.addEventListener('touchcancel', (e) => {
                        element.style.transform = '';
                    }, { passive: true });
                });

                // Prevent double-tap zoom on buttons
                document.querySelectorAll('button').forEach(button => {
                    let lastTap = 0;
                    button.addEventListener('touchend', (e) => {
                        const currentTime = new Date().getTime();
                        const tapLength = currentTime - lastTap;
                        if (tapLength < 500 && tapLength > 0) {
                            e.preventDefault();
                        }
                        lastTap = currentTime;
                    });
                });
            }

            setupPWA() {
                // Register service worker
                if ('serviceWorker' in navigator) {
                    window.addEventListener('load', async () => {
                        try {
                            const registration = await navigator.serviceWorker.register(this.createServiceWorker());
                            console.log('SW registered:', registration);
                            
                            // Listen for updates
                            registration.addEventListener('updatefound', () => {
                                const newWorker = registration.installing;
                                newWorker.addEventListener('statechange', () => {
                                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                        this.showUpdateNotification();
                                    }
                                });
                            });
                        } catch (error) {
                            console.log('SW registration failed:', error);
                        }
                    });
                }

                // Handle PWA install prompt
                let deferredPrompt;
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    this.showInstallButton(deferredPrompt);
                });

                // Handle URL parameters for shortcuts
                const urlParams = new URLSearchParams(window.location.search);
                const action = urlParams.get('action');
                if (action) {
                    this.handleShortcutAction(action);
                }
            }

            createServiceWorker() {
                const swCode = `
                    const CACHE_NAME = 'hazel-v1';
                    const urlsToCache = [
                        '/',
                        '/index.html'
                    ];

                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                        self.skipWaiting();
                    });

                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });

                    self.addEventListener('activate', event => {
                        event.waitUntil(self.clients.claim());
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                return URL.createObjectURL(blob);
            }

            setupAccessibility() {
                // ARIA live region for announcements
                const liveRegion = document.createElement('div');
                liveRegion.setAttribute('aria-live', 'polite');
                liveRegion.setAttribute('aria-atomic', 'true');
                liveRegion.id = 'live-announcements';
                liveRegion.style.cssText = `
                    position: absolute;
                    left: -10000px;
                    width: 1px;
                    height: 1px;
                    overflow: hidden;
                `;
                document.body.appendChild(liveRegion);

                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                        const navItems = document.querySelectorAll('.nav-item');
                        const currentIndex = Array.from(navItems).findIndex(item => 
                            item.classList.contains('active'));
                        
                        let nextIndex;
                        if (e.key === 'ArrowLeft') {
                            nextIndex = currentIndex > 0 ? currentIndex - 1 : navItems.length - 1;
                        } else {
                            nextIndex = currentIndex < navItems.length - 1 ? currentIndex + 1 : 0;
                        }
                        
                        this.navigateTo(navItems[nextIndex].dataset.page);
                        navItems[nextIndex].focus();
                        e.preventDefault();
                    }
                });
            }

            setupEmergencyButton() {
                // Show emergency button based on mood state
                this.toggleEmergencyButton();
            }

            addHapticFeedback() {
                if ('vibrate' in navigator) {
                    navigator.vibrate(10);
                }
            }

            announce(message) {
                const liveRegion = document.getElementById('live-announcements');
                if (liveRegion) {
                    liveRegion.textContent = message;
                    setTimeout(() => {
                        liveRegion.textContent = '';
                    }, 1000);
                }
            }

            navigateTo(page) {
                // Add loading state
                document.body.classList.add('loading');
                
                // Hide all pages
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                
                // Show selected page
                setTimeout(() => {
                    document.getElementById(page).classList.add('active');
                    document.querySelector(`[data-page="${page}"]`).classList.add('active');
                    document.body.classList.remove('loading');
                    
                    // Scroll to top
                    document.getElementById(page).scrollTo(0, 0);
                    
                    // Announce page change
                    this.announce(`Navigated to ${page} page`);
                }, 100);
                
                this.currentPage = page;
                this.hideSupportPanel();
                
                // Update browser history
                if (history.pushState) {
                    history.pushState({page: page}, '', `#${page}`);
                }

                // Special handling for dashboard
                if (page === 'dashboard') {
                    setTimeout(() => {
                        document.querySelectorAll('.tab-item').forEach(tab => tab.classList.remove('active'));
                        document.querySelector('.tab-item').classList.add('active');
                        this.showTabContent('self-harm');
                    }, 150);
                }
            }

            handleMoodSelect(mood) {
                if (mood === 'very-sad' || mood === 'sad') {
                    this.showSupportPanel();
                    this.showEmergencyButton();
                } else {
                    this.hideEmergencyButton();
                }
                
                // Store mood selection
                const todayMood = {
                    mood: mood,
                    date: new Date().toISOString(),
                    timestamp: Date.now()
                };
                
                let moodHistory = JSON.parse(localStorage.getItem('moodHistory') || '[]');
                moodHistory.unshift(todayMood);
                
                // Keep only last 30 days
                moodHistory = moodHistory.slice(0, 30);
                localStorage.setItem('moodHistory', JSON.stringify(moodHistory));
            }

            showSupportPanel() {
                document.getElementById('supportPanel').classList.add('show');
                this.announce('Support options available');
            }

            hideSupportPanel() {
                document.getElementById('supportPanel').classList.remove('show');
            }

            showEmergencyButton() {
                document.getElementById('emergencyBtn').classList.add('show');
            }

            hideEmergencyButton() {
                document.getElementById('emergencyBtn').classList.remove('show');
            }

            toggleEmergencyButton() {
                // Check recent mood entries
                const moodHistory = JSON.parse(localStorage.getItem('moodHistory') || '[]');
                const recentMoods = moodHistory.slice(0, 3);
                const hasRecentNegativeMood = recentMoods.some(entry => 
                    entry.mood === 'very-sad' || entry.mood === 'sad'
                );
                
                if (hasRecentNegativeMood) {
                    this.showEmergencyButton();
                } else {
                    this.hideEmergencyButton();
                }
            }

            showCrisisOptions() {
                const modal = document.createElement('div');
                modal.className = 'modal show';
                modal.style.zIndex = '1200';
                
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 300px;">
                        <h2 style="color: #ff4444; margin-bottom: var(--space-lg); text-align: center;">Crisis Support</h2>
                        <p style="margin-bottom: var(--space-lg); text-align: center;">You're not alone. Help is available.</p>
                        
                        <button onclick="window.open('tel:112')" class="btn btn-danger" style="width: 100%; margin-bottom: var(--space-md);">
                            📞 Call Emergency (112)
                        </button>
                        
                        <button onclick="window.open('tel:1800666666')" class="btn btn-primary" style="width: 100%; margin-bottom: var(--space-md);">
                            📞 Call Childline
                        </button>
                        
                        <button onclick="this.closest('.modal').remove()" class="btn btn-secondary" style="width: 100%;">
                            Close
                        </button>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Auto-remove after 30 seconds
                setTimeout(() => {
                    if (modal.parentNode) modal.remove();
                }, 30000);
                
                this.announce('Crisis support options displayed');
            }

            handleSupportAction(action) {
                switch(action) {
                    case 'journal':
                        this.hideSupportPanel();
                        this.navigateTo('journal');
                        setTimeout(() => this.showNewEntryForm(), 200);
                        break;
                    case 'hotlines':
                        this.hideSupportPanel();
                        this.showHotlines();
                        break;
                    case 'dashboard':
                        this.hideSupportPanel();
                        this.navigateTo('dashboard');
                        break;
                    case 'close':
                        this.hideSupportPanel();
                        break;
                }
            }

            // Sobriety Tracker Methods
            initSobrietyTracker() {
                if (!this.sobrietyStartDate) {
                    this.sobrietyStartDate = new Date().toISOString();
                    localStorage.setItem('sobrietyStartDate', this.sobrietyStartDate);
                }
                this.updateSobrietyDisplay();
            }

            updateSobrietyDisplay() {
                if (!this.sobrietyStartDate) return;

                const startDate = new Date(this.sobrietyStartDate);
                const today = new Date();
                const diffTime = Math.abs(today - startDate);
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

                document.getElementById('sobrietyDays').textContent = diffDays;

                const motivationText = this.getMotivationText(diffDays);
                document.getElementById('motivationText').textContent = motivationText;

                const milestone = this.getNextMilestone(diffDays);
                const progress = this.getMilestoneProgress(diffDays, milestone);
                
                document.getElementById('progressFill').style.width = `${progress}%`;
                document.getElementById('milestoneText').textContent = this.getMilestoneText(diffDays, milestone);
            }

            getMotivationText(days) {
                if (days === 0) return "Every day is a victory! Your journey starts now.";
                if (days < 7) return `${days} day${days === 1 ? '' : 's'} of strength! Keep going.`;
                if (days < 30) return `${Math.floor(days/7)} week${Math.floor(days/7) === 1 ? '' : 's'}+ of positive choices! Your strength shines.`;
                if (days < 90) return `${Math.floor(days/30)} month${Math.floor(days/30) === 1 ? '' : 's'}+ of positive choices! Your strength shines.`;
                if (days < 365) return `${Math.floor(days/30)} months+ of incredible progress! You're amazing.`;
                return `${Math.floor(days/365)} year${Math.floor(days/365) === 1 ? '' : 's'}+ of transformation! Incredible journey!`;
            }

            getNextMilestone(days) {
                const milestones = [1, 3, 7, 14, 30, 60, 90, 180, 365, 730, 1095];
                for (let milestone of milestones) {
                    if (days < milestone) return milestone;
                }
                return Math.ceil(days / 365) * 365;
            }

            getMilestoneProgress(days, milestone) {
                if (milestone <= 1) return days * 100;
                
                let previousMilestone = 0;
                const milestones = [1, 3, 7, 14, 30, 60, 90, 180, 365];
                
                for (let i = 0; i < milestones.length; i++) {
                    if (milestones[i] === milestone) {
                        previousMilestone = i > 0 ? milestones[i-1] : 0;
                        break;
                    }
                }
                
                return Math.min(100, ((days - previousMilestone) / (milestone - previousMilestone)) * 100);
            }

            getMilestoneText(days, milestone) {
                const daysLeft = milestone - days;
                if (daysLeft <= 0) return "Milestone reached! 🎉";
                
                let milestoneText = "";
                if (milestone === 1) milestoneText = "1 day";
                else if (milestone === 3) milestoneText = "3 days";
                else if (milestone === 7) milestoneText = "1 week";
                else if (milestone === 14) milestoneText = "2 weeks";
                else if (milestone === 30) milestoneText = "1 month";
                else if (milestone === 60) milestoneText = "2 months";
                else if (milestone === 90) milestoneText = "3 months";
                else if (milestone === 180) milestoneText = "6 months";
                else if (milestone === 365) milestoneText = "1 year";
                else milestoneText = `${milestone} days`;
                
                return `Next milestone: ${milestoneText} (${daysLeft} day${daysLeft === 1 ? '' : 's'} left)`;
            }

            editSobrietyDate() {
                const currentDate = this.sobrietyStartDate ? new Date(this.sobrietyStartDate).toISOString().split('T')[0] : new Date().toISOString().split('T')[0];
                const newDate = prompt("Enter your sobriety start date (YYYY-MM-DD):", currentDate);
                
                if (newDate && newDate !== currentDate) {
                    this.sobrietyStartDate = new Date(newDate).toISOString();
                    localStorage.setItem('sobrietyStartDate', this.sobrietyStartDate);
                    this.updateSobrietyDisplay();
                    this.announce('Sobriety date updated');
                }
            }

            confirmSobrietyReset() {
                if (confirm('Reset your sobriety tracker? This action cannot be undone.')) {
                    this.sobrietyStartDate = new Date().toISOString();
                    localStorage.setItem('sobrietyStartDate', this.sobrietyStartDate);
                    this.updateSobrietyDisplay();
                    this.announce('Sobriety tracker reset');
                }
            }

            // Streak Management
            updateStreak() {
                const today = new Date().toDateString();
                const yesterday = new Date(Date.now() - 86400000).toDateString();
                
                if (this.lastLoginDate === yesterday) {
                    this.streak++;
                } else if (this.lastLoginDate !== today) {
                    this.streak = 1;
                }
                
                localStorage.setItem('streak', this.streak.toString());
                localStorage.setItem('lastLoginDate', today);
                
                this.displayStreak();
            }

            displayStreak() {
                const container = document.getElementById('streakContainer');
                container.innerHTML = '';
                
                const heartsToShow = Math.min(this.streak, 7);
                for (let i = 0; i < heartsToShow; i++) {
                    const heart = document.createElement('span');
                    heart.className = 'heart';
                    heart.textContent = '❤️';
                    container.appendChild(heart);
                }
                
                if (this.streak >= 7) {
                    const hazelnut = document.createElement('span');
                    hazelnut.className = 'hazelnut';
                    hazelnut.textContent = '🌰';
                    container.appendChild(hazelnut);
                }
            }

            // Journal Methods
            loadJournalEntries() {
                const container = document.getElementById('journalEntries');
                
                if (this.journalEntries.length === 0) {
                    container.innerHTML = '<div class="empty-state">No journal entries yet. Start writing to track your thoughts and feelings.</div>';
                    return;
                }
                
                container.innerHTML = this.journalEntries.map(entry => `
                    <div class="journal-entry" data-entry-id="${entry.id}">
                        <div class="entry-title">${entry.title}</div>
                        <div class="entry-date">${new Date(entry.date).toLocaleDateString()}</div>
                        ${entry.mood ? `<div class="entry-mood">${this.getMoodEmoji(entry.mood)}</div>` : ''}
                    </div>
                `).join('');

                // Add click listeners to entries
                container.querySelectorAll('.journal-entry').forEach(entry => {
                    entry.addEventListener('click', () => {
                        this.viewEntry(parseInt(entry.dataset.entryId));
                    });
                });
            }

            getMoodEmoji(mood) {
                const moodEmojis = {
                    'very-sad': '😢',
                    'sad': '😔',
                    'neutral': '😐',
                    'happy': '😊',
                    'very-happy': '😄'
                };
                return moodEmojis[mood] || '';
            }

            showNewEntryForm() {
                const today = new Date().toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                document.getElementById('journalEntries').innerHTML = `
                    <div class="entry-form">
                        <h3 style="color: #435334; margin-bottom: var(--space-lg);">${this.isEditingEntry ? 'Edit Entry' : 'New Entry'} - ${today}</h3>
                        
                        <div class="form-group">
                            <label class="form-label">Title</label>
                            <input type="text" id="entryTitle" class="form-input" placeholder="How are you feeling?" autocomplete="off">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Content</label>
                            <textarea id="entryContent" class="form-textarea" placeholder="Write your thoughts here..." rows="6"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Mood</label>
                            <div class="mood-selector">
                                <button type="button" class="mood-btn" data-mood="very-sad">😢</button>
                                <button type="button" class="mood-btn" data-mood="sad">😔</button>
                                <button type="button" class="mood-btn" data-mood="neutral">😐</button>
                                <button type="button" class="mood-btn" data-mood="happy">😊</button>
                                <button type="button" class="mood-btn" data-mood="very-happy">😄</button>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelEntryBtn">Cancel</button>
                            <button type="button" class="btn btn-primary" id="saveEntryBtn">${this.isEditingEntry ? 'Update' : 'Save'} Entry</button>
                        </div>
                    </div>
                `;

                // Add event listeners
                document.querySelectorAll('.mood-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        this.selectedMood = btn.dataset.mood;
                    });
                });

                document.getElementById('cancelEntryBtn').addEventListener('click', () => {
                    this.selectedMood = null;
                    this.isEditingEntry = false;
                    this.editingEntryId = null;
                    this.loadJournalEntries();
                });

                document.getElementById('saveEntryBtn').addEventListener('click', () => {
                    this.saveEntry();
                });

                // Auto-resize textarea
                const textarea = document.getElementById('entryContent');
                textarea.addEventListener('input', () => {
                    textarea.style.height = 'auto';
                    textarea.style.height = `${Math.min(textarea.scrollHeight, 300)}px`;
                });

                // Load existing entry data if editing
                if (this.isEditingEntry && this.editingEntryId) {
                    const entry = this.journalEntries.find(e => e.id === this.editingEntryId);
                    if (entry) {
                        document.getElementById('entryTitle').value = entry.title;
                        document.getElementById('entryContent').value = entry.content;
                        if (entry.mood) {
                            const moodBtn = document.querySelector(`[data-mood="${entry.mood}"]`);
                            if (moodBtn) {
                                moodBtn.classList.add('selected');
                                this.selectedMood = entry.mood;
                            }
                        }
                    }
                }
            }

            saveEntry() {
                const title = document.getElementById('entryTitle').value.trim();
                const content = document.getElementById('entryContent').value.trim();
                
                if (!title) {
                    alert('Please enter a title for your entry');
                    return;
                }
                
                if (this.isEditingEntry && this.editingEntryId) {
                    // Update existing entry
                    const entryIndex = this.journalEntries.findIndex(e => e.id === this.editingEntryId);
                    if (entryIndex !== -1) {
                        this.journalEntries[entryIndex] = {
                            ...this.journalEntries[entryIndex],
                            title: title,
                            content: content,
                            mood: this.selectedMood,
                            lastModified: new Date().toISOString()
                        };
                    }
                } else {
                    // Create new entry
                    const entry = {
                        id: Date.now(),
                        title: title,
                        content: content,
                        mood: this.selectedMood,
                        date: new Date().toISOString(),
                        tags: []
                    };
                    
                    this.journalEntries.unshift(entry);
                }
                
                localStorage.setItem('journalEntries', JSON.stringify(this.journalEntries));
                
                this.selectedMood = null;
                this.isEditingEntry = false;
                this.editingEntryId = null;
                this.loadJournalEntries();
                this.announce('Journal entry saved');
            }

            viewEntry(id) {
                const entry = this.journalEntries.find(e => e.id === id);
                if (!entry) return;
                
                const moodEmoji = this.getMoodEmoji(entry.mood);
                
                document.getElementById('journalEntries').innerHTML = `
                    <div class="entry-form">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-lg);">
                            <h3 style="color: #435334;">${entry.title}</h3>
                            ${moodEmoji ? `<span style="font-size: 1.5rem;">${moodEmoji}</span>` : ''}
                        </div>
                        
                        <div style="color: var(--text-secondary); margin-bottom: var(--space-lg); font-size: var(--text-sm);">
                            ${new Date(entry.date).toLocaleDateString('en-US', { 
                                weekday: 'long', 
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}
                        </div>
                        
                        <div style="line-height: 1.6; margin-bottom: var(--space-xl); white-space: pre-wrap;">
                            ${entry.content}
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="backToListBtn">Back</button>
                            <button type="button" class="btn btn-primary" id="editEntryBtn">Edit</button>
                            <button type="button" class="btn btn-danger" id="deleteEntryBtn">Delete</button>
                        </div>
                    </div>
                `;

                document.getElementById('backToListBtn').addEventListener('click', () => {
                    this.loadJournalEntries();
                });

                document.getElementById('editEntryBtn').addEventListener('click', () => {
                    this.isEditingEntry = true;
                    this.editingEntryId = id;
                    this.showNewEntryForm();
                });

                document.getElementById('deleteEntryBtn').addEventListener('click', () => {
                    if (confirm('Are you sure you want to delete this entry?')) {
                        this.deleteEntry(id);
                    }
                });
            }

            deleteEntry(id) {
                this.journalEntries = this.journalEntries.filter(e => e.id !== id);
                localStorage.setItem('journalEntries', JSON.stringify(this.journalEntries));
                this.loadJournalEntries();
                this.announce('Journal entry deleted');
            }

            // Dashboard/Resources Methods
            showTabContent(category) {
                // Update tab selection
                document.querySelectorAll('.tab-item').forEach(tab => tab.classList.remove('active'));
                document.querySelector(`[data-tab="${category}"]`).classList.add('active');
                
                const content = this.getTabContent(category);
                document.getElementById('tabContent').innerHTML = content;

                // Add event listeners to resource buttons
                document.querySelectorAll('.resource-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.openLink(btn.dataset.url);
                    });
                });
            }

            getTabContent(category) {
                const categories = {
                    'self-harm': {
                        alternatives: [
                            'Draw or create art',
                            'Write in your journal', 
                            'Listen to music or sing',
                            'Pet an animal or hold a soft object',
                            'Eat something with a strong taste',
                            'Watch a comfort show or movie',
                            'Take deep breaths and go for a walk',
                            'Hold ice cubes or take a cold shower',
                            'Exercise or do stretches'
                        ],
                        resources: [
                            { name: 'Pieta House', url: 'https://www.pieta.ie/how-we-can-help/' },
                            { name: 'HSE Mental Health', url: 'https://www.hse.ie/eng/services/list/4/mental-health-services/nosp/resources/selfharmyoung.pdf' },
                            { name: 'Tusla', url: 'https://www.tusla.ie/parenting-24-seven/12-years/child-safety-practices-reduce-injury/self-harm/' },
                            { name: 'St Patrick\'s MHS', url: 'https://www.stpatricks.ie/media-centre/blogs-articles/2023/february/self-harm-causes-and-supports' }
                        ]
                    },
                    'ed': {
                        alternatives: [
                            'Talk to a trusted friend or family member',
                            'Drink water or herbal tea',
                            'Practice mindful eating',
                            'Write about your feelings',
                            'Use positive affirmations',
                            'Call a support line',
                            'Join an online support group',
                            'Practice gentle movement or yoga'
                        ],
                        resources: [
                            { name: 'BodyWhys', url: 'https://bodywhys.ie' },
                            { name: 'HSE Eating Disorders', url: 'https://www.hse.ie/eng/about/who/cspd/ncps/mental-health/eating-disorders/' },
                            { name: 'National ED Recovery Centre', url: 'https://nedrc.ie/' },
                            { name: 'St Patrick\'s MHS', url: 'https://www.stpatricks.ie/mental-health/eating-disorders' }
                        ]
                    },
                    'anxiety': {
                        alternatives: [
                            'Practice deep breathing exercises',
                            'Use the 5-4-3-2-1 grounding technique',
                            'Go for a short walk outside',
                            'Listen to calming music',
                            'Squeeze a stress ball or fidget toy',
                            'Write down your worries',
                            'Do progressive muscle relaxation',
                            'Call someone you trust'
                        ],
                        resources: [
                            { name: 'Aware', url: 'https://www.aware.ie/information/anxiety/' },
                            { name: 'HSE Anxiety Support', url: 'https://www2.hse.ie/conditions/anxiety-tips-and-self-help/' },
                            { name: 'Spunout', url: 'https://spunout.ie/category/mental-health/anxiety-stress' },
                            { name: 'St Patrick\'s MHS', url: 'https://www.stpatricks.ie/mental-health/anxiety' }
                        ]
                    },
                    'depression': {
                        alternatives: [
                            'Listen to uplifting music',
                            'Take a warm shower or bath',
                            'Complete one small task',
                            'Text or call a supportive friend',
                            'Spend time in nature or by a window',
                            'Create something simple',
                            'Practice gratitude by listing 3 good things',
                            'Do gentle movement or stretching'
                        ],
                        resources: [
                            { name: 'Aware', url: 'https://www.aware.ie/information/depression/' },
                            { name: 'HSE Depression Support', url: 'https://www2.hse.ie/conditions/depression/' },
                            { name: 'Spunout', url: 'https://spunout.ie/category/mental-health/depression' },
                            { name: 'St Patrick\'s MHS', url: 'https://www.stpatricks.ie/mental-health/depression' }
                        ]
                    }
                };
                
                const data = categories[category];
                if (!data) return '';
                
                return `
                    <div class="alternatives-section">
                        <div class="section-title">Alternatives</div>
                        <div class="section-divider"></div>
                        <div class="alternatives-list">
                            ${data.alternatives.map(alt => `• ${alt}`).join('<br>')}
                        </div>
                    </div>
                    
                    <div class="resources-section">
                        <div class="section-title">Resources</div>
                        <div class="section-divider"></div>
                        ${data.resources.map(resource => 
                            `<button class="resource-btn" data-url="${resource.url}">${resource.name}</button>`
                        ).join('')}
                    </div>
                `;
            }

            // Hotlines Methods
            showHotlines() {
                document.getElementById('hotlinesModal').classList.add('show');
                this.announce('Hotlines directory displayed');
            }

            hideHotlines() {
                document.getElementById('hotlinesModal').classList.remove('show');
            }

            callNumber(number) {
                window.open(`tel:${number}`, '_self');
                this.announce(`Calling ${number}`);
            }

            openLink(url) {
                window.open(url, '_blank');
            }

            // Task Management Methods
            loadTasks() {
                const container = document.getElementById('tasksContainer');
                
                if (this.tasks.length === 0) {
                    container.innerHTML = '<div style="text-align: center; opacity: 0.7; padding: var(--space-xl);">No tasks yet. Add one above!</div>';
                    return;
                }

                let html = '';
                this.tasks.forEach(task => {
                    html += this.renderTask(task, false);
                    if (task.subtasks && task.subtasks.length > 0) {
                        task.subtasks.forEach(subtask => {
                            html += this.renderTask(subtask, true, task.id);
                        });
                    }
                });
                
                container.innerHTML = html;

                // Add event listeners
                container.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('click', (e) => {
                        const taskItem = e.target.closest('.task-item');
                        const taskId = parseInt(taskItem.dataset.taskId);
                        const parentId = taskItem.dataset.parentId ? parseInt(taskItem.dataset.parentId) : null;
                        this.toggleTask(taskId, parentId);
                    });
                });

                container.querySelectorAll('.delete-task-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const taskItem = e.target.closest('.task-item');
                        const taskId = parseInt(taskItem.dataset.taskId);
                        const parentId = taskItem.dataset.parentId ? parseInt(taskItem.dataset.parentId) : null;
                        this.deleteTask(taskId, parentId);
                    });
                });
            }

            renderTask(task, isSubtask = false, parentId = null) {
                return `
                    <div class="task-item ${isSubtask ? 'subtask' : 'main-task'}" data-task-id="${task.id}" ${parentId ? `data-parent-id="${parentId}"` : ''}>
                        <div class="task-checkbox ${task.completed ? 'completed' : ''}"></div>
                        <div class="task-text ${task.completed ? 'completed' : ''}">${task.text}</div>
                        <div class="task-actions">
                            <button class="action-btn delete-task-btn" title="Delete task" style="background: none; border: none; color: #ff6b6b; cursor: pointer; padding: var(--space-xs); border-radius: 4px;">🗑️</button>
                        </div>
                    </div>
                `;
            }

            addTask() {
                const input = document.getElementById('taskInput');
                const text = input.value.trim();
                
                if (text === '') return;
                
                const newTask = {
                    id: this.nextTaskId++,
                    text: text,
                    completed: false,
                    subtasks: []
                };
                
                this.tasks.push(newTask);
                input.value = '';
                
                this.saveTasks();
                this.loadTasks();
                this.announce('Task added');
            }

            toggleTask(taskId, parentId = null) {
                let task = null;
                
                if (parentId) {
                    const parentTask = this.tasks.find(t => t.id === parentId);
                    if (parentTask && parentTask.subtasks) {
                        task = parentTask.subtasks.find(st => st.id === taskId);
                    }
                } else {
                    task = this.tasks.find(t => t.id === taskId);
                }
                
                if (task) {
                    task.completed = !task.completed;
                    this.saveTasks();
                    this.loadTasks();
                    this.announce(task.completed ? 'Task completed' : 'Task uncompleted');
                }
            }

            deleteTask(taskId, parentId = null) {
                if (!confirm('Delete this task?')) return;
                
                if (parentId) {
                    const parentTask = this.tasks.find(t => t.id === parentId);
                    if (parentTask && parentTask.subtasks) {
                        parentTask.subtasks = parentTask.subtasks.filter(st => st.id !== taskId);
                    }
                } else {
                    this.tasks = this.tasks.filter(t => t.id !== taskId);
                }
                
                this.saveTasks();
                this.loadTasks();
                this.announce('Task deleted');
            }

            saveTasks() {
                localStorage.setItem('tasks', JSON.stringify(this.tasks));
                localStorage.setItem('nextTaskId', this.nextTaskId.toString());
            }

            // Menu/Recipe Methods
            showRecipes(category) {
                const recipes = {
                    breakfast: [
                        { name: 'Chocolate Chip Pancakes', description: 'Fluffy pancakes with chocolate chips' },
                        { name: 'Avocado Toast', description: 'Healthy toast with smashed avocado' },
                        { name: 'Oatmeal with Berries', description: 'Warm oats topped with fresh berries' }
                    ],
                    lunch: [
                        { name: 'Chicken Salad', description: 'Grilled chicken with mixed greens' },
                        { name: 'Veggie Wrap', description: 'Fresh vegetables in a whole wheat wrap' },
                        { name: 'Tomato Soup & Grilled Cheese', description: 'Classic comfort food combo' }
                    ],
                    dinner: [
                        { name: 'Spaghetti Bolognese', description: 'Classic pasta with meat sauce' },
                        { name: 'Grilled Salmon', description: 'Fresh salmon with roasted vegetables' },
                        { name: 'Vegetable Stir Fry', description: 'Colorful vegetables in savory sauce' }
                    ],
                    snacks: [
                        { name: 'Chocolate Chip Cookies', description: 'Soft and chewy homemade cookies' },
                        { name: 'Fruit Smoothie', description: 'Refreshing blend of fruits and yogurt' },
                        { name: 'Mixed Nuts & Dried Fruits', description: 'Healthy trail mix for energy' }
                    ]
                };
                
                const categoryRecipes = recipes[category] || [];
                const categoryTitle = category.charAt(0).toUpperCase() + category.slice(1);
                
                document.getElementById('menus').innerHTML = `
                    <h2 style="text-align: center; margin-bottom: var(--space-lg); font-size: var(--text-2xl); font-weight: 700;">${categoryTitle}</h2>
                    <button class="btn btn-secondary" id="backToCategoriesBtn" style="margin-bottom: var(--space-lg);">← Back to Categories</button>
                    <div class="menu-categories">
                        ${categoryRecipes.map(recipe => `
                            <div class="menu-category">
                                <div class="category-icon">🍽️</div>
                                <div>
                                    <div class="category-title">${recipe.name}</div>
                                    <div style="font-size: var(--text-sm); color: var(--text-secondary); margin-top: var(--space-xs);">${recipe.description}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;

                document.getElementById('backToCategoriesBtn').addEventListener('click', () => {
                    location.reload();
                });
            }

            // Utility Methods
            handleShortcutAction(action) {
                switch(action) {
                    case 'new-journal':
                        this.navigateTo('journal');
                        setTimeout(() => this.showNewEntryForm(), 300);
                        break;
                    case 'crisis':
                        this.showHotlines();
                        break;
                    case 'mood':
                        this.navigateTo('home');
                        break;
                }
            }

            showUpdateNotification() {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: calc(20px + var(--safe-area-inset-top));
                    left: 50%;
                    transform: translateX(-50%);
                    background: var(--surface-color);
                    padding: var(--space-md);
                    border-radius: var(--radius-md);
                    box-shadow: var(--shadow-lg);
                    z-index: var(--z-tooltip);
                    text-align: center;
                    max-width: 300px;
                `;
                notification.innerHTML = `
                    <p style="margin-bottom: var(--space-sm);">New version available!</p>
                    <button onclick="location.reload()" class="btn btn-primary" style="padding: var(--space-sm) var(--space-md);">Update</button>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => notification.remove(), 5000);
            }

            showInstallButton(deferredPrompt) {
                const installButton = document.createElement('button');
                installButton.textContent = 'Install App';
                installButton.className = 'btn btn-secondary';
                installButton.style.cssText = `
                    position: fixed;
                    top: calc(20px + var(--safe-area-inset-top));
                    right: 20px;
                    z-index: var(--z-tooltip);
                    font-size: var(--text-sm);
                    padding: var(--space-sm) var(--space-md);
                `;
                
                installButton.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log('Install prompt outcome:', outcome);
                        installButton.remove();
                    }
                });
                
                document.body.appendChild(installButton);
            }
        }

        // Initialize the app when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            window.hazelApp = new HazelApp();
        });

        // Handle browser back button
        window.addEventListener('popstate', (e) => {
            if (e.state && e.state.page && window.hazelApp) {
                window.hazelApp.navigateTo(e.state.page);
            }
        });

        // Handle online/offline status
        window.addEventListener('online', () => {
            console.log('App is online');
            document.body.classList.remove('offline');
        });

        window.addEventListener('offline', () => {
            console.log('App is offline');
            document.body.classList.add('offline');
        });
    </script>
</body>
</html>
