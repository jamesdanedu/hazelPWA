<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#A2AE83">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Hazel">
    <title>Hazel - Mental Health Support</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkhhemVsIC0gTWVudGFsIEhlYWx0aCBTdXBwb3J0IiwKICAic2hvcnRfbmFtZSI6ICJIYXplbCIsCiAgImRlc2NyaXB0aW9uIjogIk1lbnRhbCBoZWFsdGggc3VwcG9ydCBhcHAgd2l0aCBqb3VybmFsaW5nLCByZXNvdXJjZXMsIGFuZCBjcmlzaXMgc3VwcG9ydCIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgIm9yaWVudGF0aW9uIjogInBvcnRyYWl0IiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjQTJBRTgzIiwKICAidGhlbWVfY29sb3IiOiAiI0EyQUU4MyIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJeE9USmNJaUJvWldsbmFIUTlJakU1TW5jaUlIWnBaWGRDYjNnOUlqQWdNQ0F4T1RJZ01UazJYQ0krUEhKbFkzUWdkMmxrZEdnOUlqRTVNaUlnYUdWcFoyaDBQU0l4T1RJaUlHWnBiR3c5SWlOQk1rRkZPRE5jSWk4K1BIUmxlSFFnZUQwaU9UWWlJSGs5SWpFeE1DSUJHWEJ1ZEMxemFYcGxQU0k0TkNJZ2RHVjRkQzFoYm1Ob2IzSTlJbTFwWkdSc1pTSStxS2FzOERBdmRHVjRkRDQ4TDNOMlp6ND0iLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAicHVycG9zZSI6ICJhbnkgbWFza2FibGUiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJMU1USndlQ0lnYUdWcFoyaDBQU0kxTVRKd2VDSWdkbWxsZDBKdmVEMGlNQ0F3SURRNU1UZ3dYQ0krUEhKbFkzUWdkMmxrZEdnOUlqVXhNaUlnYUdWcFoyaDBQU0kxTVRJaUlHWnBiR3c5SWlOQk1rRkZPRE5jSWk4K1BIUmxlSFFnZUQwaU1qVTJJaUJaUFNJek1EQWlJR1p2Ym5RdGMybDZaVDBpTWpBd0lpQjBaWGgwTFdGdVkyaHZjajBpYldsa1pHeGxYQ0krcUthczhEQXZkR1Y0ZEQ0OEwzTjJaejQ9IiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIsCiAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIgogICAgfQogIF0sCiAgInNob3J0Y3V0cyI6IFsKICAgIHsKICAgICAgIm5hbWUiOiAiTmV3IEpvdXJuYWwgRW50cnkiLAogICAgICAic2hvcnRfbmFtZSI6ICJKb3VybmFsIiwKICAgICAgInVybCI6ICIvP2FjdGlvbj1uZXctam91cm5hbCIKICAgIH0sCiAgICB7CiAgICAgICJuYW1lIjogIkNyaXNpcyBTdXBwb3J0IiwKICAgICAgInNob3J0X25hbWUiOiAiQ3Jpc2lzIiwKICAgICAgInVybCI6ICIvP2FjdGlvbj1jcmlzaXMiCiAgICB9CiAgXQp9">

    <!-- Apple Touch Icons for iOS PWA -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxODAiIGZpbGw9IiNBMkFFODMiLz48dGV4dCB4PSI5MCIgeT0iMTEwIiBmb250LXNpemU9IjgwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7wn42wPC90ZXh0Pjwvc3ZnPg==">

    <style>
        /* CSS Custom Properties */
        :root {
            --primary-color: #A2AE83;
            --secondary-color: #7D8F5E;
            --accent-color: #435334;
            --text-primary: #333;
            --text-secondary: #666;
            --surface-color: rgba(255,255,255,0.95);
            --background-gradient: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            
            /* Typography */
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
            --text-3xl: 1.875rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            /* Radius */
            --radius-sm: 0.125rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-full: 9999px;
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--background-gradient);
            height: 100vh;
            overflow: hidden;
            position: fixed;
            width: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        /* Safe area support for notched devices */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: 100dvh;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }

        /* Pages */
        .page {
            display: none;
            flex: 1;
            padding: var(--space-lg);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            min-height: 0;
            position: relative;
        }

        .page.active {
            display: flex;
            flex-direction: column;
        }

        /* Home Page Styles */
        .home-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: var(--space-xl);
            flex: 1;
            justify-content: center;
            max-width: 500px;
            margin: 0 auto;
            padding: var(--space-lg);
        }

        .app-title {
            font-size: clamp(2.5rem, 8vw, 4rem);
            font-weight: 800;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: var(--space-md);
        }

        .app-subtitle {
            font-size: var(--text-xl);
            color: rgba(255,255,255,0.9);
            margin-bottom: var(--space-2xl);
        }

        .mood-check {
            background: rgba(255,255,255,0.95);
            padding: var(--space-xl);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 400px;
        }

        .mood-question {
            font-size: var(--text-lg);
            font-weight: 600;
            margin-bottom: var(--space-lg);
            color: var(--accent-color);
        }

        .emoji-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .emoji-btn {
            background: var(--surface-color);
            border: 3px solid transparent;
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            min-height: 64px;
        }

        .emoji-btn:hover,
        .emoji-btn:focus {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .emoji-btn.selected {
            background: var(--primary-color);
            border-color: var(--accent-color);
            transform: scale(1.1);
        }

        .support-section {
            margin-top: var(--space-xl);
        }

        .support-question {
            font-size: var(--text-base);
            margin-bottom: var(--space-md);
            color: var(--text-secondary);
        }

        .support-buttons {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            flex-wrap: wrap;
        }

        .support-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-md);
            min-height: 44px;
        }

        .support-btn:hover,
        .support-btn:focus {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .emergency-btn {
            background: #e53e3e;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .emergency-btn:hover,
        .emergency-btn:focus {
            background: #c53030;
        }

        /* Sobriety Tracker */
        .sobriety-tracker {
            background: rgba(255,255,255,0.95);
            padding: var(--space-xl);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 400px;
            margin-top: var(--space-lg);
        }

        .tracker-title {
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: var(--space-lg);
            text-align: center;
        }

        .days-sober {
            font-size: clamp(2rem, 6vw, 3rem);
            font-weight: 800;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: var(--space-md);
        }

        .sober-label {
            font-size: var(--text-base);
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: var(--space-lg);
        }

        .progress-section {
            margin-bottom: var(--space-lg);
        }

        .progress-label {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: var(--space-md);
        }

        .progress-bar {
            background: rgba(162, 174, 131, 0.2);
            height: 8px;
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-bottom: var(--space-md);
        }

        .progress-fill {
            background: var(--primary-color);
            height: 100%;
            border-radius: var(--radius-full);
            transition: width 0.3s ease;
            width: 0%;
        }

        .milestone-text {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            text-align: center;
        }

        .edit-sobriety-btn {
            background: none;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            margin-top: var(--space-md);
        }

        .edit-sobriety-btn:hover,
        .edit-sobriety-btn:focus {
            background: var(--primary-color);
            color: white;
        }

        /* Streak Display */
        .streak-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-sm);
            margin-top: var(--space-lg);
            padding: var(--space-md);
            background: rgba(255,255,255,0.1);
            border-radius: var(--radius-lg);
        }

        .streak-text {
            color: white;
            font-weight: 600;
        }

        .streak-number {
            font-size: var(--text-xl);
            font-weight: 800;
            color: #ffd700;
        }

        /* Navigation Styles */
        .bottom-nav {
            display: flex;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.2);
            padding: var(--space-sm) 0;
            margin: 0 calc(-1 * var(--space-lg));
            margin-bottom: calc(-1 * var(--space-lg));
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--space-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: var(--radius-md);
            margin: 0 var(--space-xs);
            min-height: 60px;
            justify-content: center;
        }

        .nav-item:hover,
        .nav-item:focus {
            background: rgba(162, 174, 131, 0.1);
            transform: translateY(-2px);
        }

        .nav-item.active {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .nav-icon {
            font-size: 1.5rem;
            margin-bottom: var(--space-xs);
        }

        .nav-text {
            font-size: var(--text-xs);
            font-weight: 600;
            text-align: center;
        }

        /* Dashboard Styles */
        .dashboard-container {
            display: flex;
            flex: 1;
            gap: var(--space-lg);
            min-height: 0;
        }

        .tab-sidebar {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            min-width: 120px;
        }

        .tab-item {
            background: rgba(255,255,255,0.8);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--accent-color);
            box-shadow: var(--shadow-sm);
        }

        .tab-item:hover,
        .tab-item:focus {
            background: rgba(255,255,255,0.95);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .tab-item.active {
            background: var(--primary-color);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .tab-content {
            flex: 1;
            background: rgba(255,255,255,0.95);
            padding: var(--space-xl);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .crisis-header {
            background: #e53e3e;
            color: white;
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-xl);
            text-align: center;
            box-shadow: var(--shadow-lg);
        }

        .crisis-title {
            font-size: var(--text-2xl);
            font-weight: 800;
            margin-bottom: var(--space-md);
        }

        .crisis-subtitle {
            font-size: var(--text-lg);
            opacity: 0.9;
        }

        .section-divider {
            height: 1px;
            background: white;
            margin-bottom: var(--space-lg);
            opacity: 0.7;
        }

        .alternatives-list {
            color: white;
            line-height: 1.8;
            margin-bottom: var(--space-xl);
            font-size: var(--text-base);
        }

        .resource-btn {
            display: block;
            width: 100%;
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            background: #C2ABF9;
            color: #000;
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 48px;
        }

        .resource-btn:hover,
        .resource-btn:focus {
            background: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Menu Categories */
        .menu-categories {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-md);
            margin-top: var(--space-lg);
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .menu-category {
            background: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .menu-category::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s ease;
        }

        .menu-category:hover::before {
            left: 100%;
        }

        .menu-category:hover,
        .menu-category:focus {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .category-icon {
            font-size: clamp(3rem, 8vw, 5rem);
            margin-bottom: var(--space-md);
            display: block;
        }

        .category-title {
            font-size: var(--text-xl);
            font-weight: 700;
            color: #435334;
        }

        /* Recipe List Styles */
        .recipe-list-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            gap: var(--space-lg);
        }

        .recipe-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .back-btn {
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: var(--radius-full);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: var(--text-lg);
            box-shadow: var(--shadow-md);
            transition: all 0.2s ease;
        }

        .back-btn:hover,
        .back-btn:focus {
            background: white;
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .recipe-category-title {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .recipe-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-md);
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .recipe-card {
            background: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .recipe-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s ease;
        }

        .recipe-card:hover::before {
            left: 100%;
        }

        .recipe-card:hover,
        .recipe-card:focus {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .recipe-title {
            font-size: var(--text-lg);
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: var(--space-sm);
        }

        .recipe-description {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Recipe Detail Styles */
        .recipe-detail-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            gap: var(--space-lg);
        }

        .recipe-detail-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .recipe-detail-title {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .recipe-content {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            box-shadow: var(--shadow-xl);
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .recipe-section {
            margin-bottom: var(--space-xl);
        }

        .recipe-section:last-child {
            margin-bottom: 0;
        }

        .recipe-section-title {
            font-size: var(--text-xl);
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-sm);
            border-bottom: 2px solid var(--primary-color);
        }

        .ingredients-list {
            list-style: none;
            margin-bottom: var(--space-lg);
        }

        .ingredients-list li {
            padding: var(--space-sm) 0;
            border-bottom: 1px solid rgba(162, 174, 131, 0.2);
            font-size: var(--text-base);
            line-height: 1.5;
        }

        .ingredients-list li:last-child {
            border-bottom: none;
        }

        .ingredients-list li::before {
            content: '🥄';
            margin-right: var(--space-sm);
        }

        .method-list {
            list-style: none;
            counter-reset: step-counter;
        }

        .method-list li {
            counter-increment: step-counter;
            padding: var(--space-md) 0;
            position: relative;
            padding-left: var(--space-2xl);
            font-size: var(--text-base);
            line-height: 1.6;
            border-bottom: 1px solid rgba(162, 174, 131, 0.2);
        }

        .method-list li:last-child {
            border-bottom: none;
        }

        .method-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: var(--space-md);
            background: var(--primary-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-sm);
            font-weight: 700;
        }

        /* Journal Styles */
        .journal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xl);
        }

        .journal-title {
            font-size: var(--text-3xl);
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .new-entry-btn {
            background: rgba(255,255,255,0.9);
            color: var(--accent-color);
            border: none;
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-md);
            min-height: 44px;
        }

        .new-entry-btn:hover,
        .new-entry-btn:focus {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .journal-entries {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .journal-entry {
            background: var(--surface-color);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .journal-entry::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-color);
        }

        .journal-entry:hover,
        .journal-entry:focus {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .entry-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: #435334;
            margin-bottom: var(--space-xs);
        }

        .entry-date {
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        .entry-mood {
            position: absolute;
            top: var(--space-md);
            right: var(--space-md);
            font-size: 1.2rem;
        }

        .empty-state {
            text-align: center;
            color: var(--text-secondary);
            font-style: italic;
            margin: var(--space-2xl) 0;
            padding: var(--space-xl);
            background: rgba(255,255,255,0.5);
            border-radius: var(--radius-lg);
        }

        /* To-Do List Styles */
        .todo-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            gap: var(--space-lg);
            min-height: 0;
        }

        .todo-title {
            font-size: var(--text-3xl);
            font-weight: 700;
            color: white;
            text-align: center;
            margin-bottom: var(--space-lg);
        }

        .add-task-container {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .task-input {
            flex: 1;
            padding: var(--space-md);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: var(--radius-full);
            background: rgba(255,255,255,0.9);
            font-size: var(--text-base);
            outline: none;
            transition: all 0.2s ease;
        }

        .task-input:focus {
            border-color: var(--primary-color);
            background: white;
            box-shadow: var(--shadow-md);
        }

        .add-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-md);
            min-height: 48px;
        }

        .add-btn:hover,
        .add-btn:focus {
            background: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .tasks-container {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .task-item {
            background: rgba(255,255,255,0.95);
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            transition: all 0.2s ease;
            position: relative;
        }

        .task-item:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--primary-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .task-checkbox.completed {
            background: var(--primary-color);
        }

        .task-checkbox.completed::after {
            content: '✓';
            color: white;
            font-size: var(--text-sm);
            font-weight: 700;
        }

        .task-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .task-text {
            font-size: var(--text-base);
            color: var(--text-primary);
            line-height: 1.5;
            transition: all 0.2s ease;
        }

        .task-text.completed {
            text-decoration: line-through;
            opacity: 0.6;
            color: var(--text-secondary);
        }

        .task-actions {
            display: flex;
            gap: var(--space-sm);
            align-items: center;
        }

        .subtask-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: var(--text-xs);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .subtask-btn:hover,
        .subtask-btn:focus {
            background: var(--secondary-color);
        }

        .delete-task-btn {
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xs);
            transition: all 0.2s ease;
        }

        .delete-task-btn:hover,
        .delete-task-btn:focus {
            background: #c53030;
        }

        .subtasks-container {
            margin-left: var(--space-xl);
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .subtask-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            background: rgba(162, 174, 131, 0.1);
            border-radius: var(--radius-md);
            transition: all 0.2s ease;
        }

        .subtask-item:hover {
            background: rgba(162, 174, 131, 0.15);
        }

        .subtask-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--secondary-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .subtask-checkbox.completed {
            background: var(--secondary-color);
        }

        .subtask-checkbox.completed::after {
            content: '✓';
            color: white;
            font-size: var(--text-xs);
            font-weight: 700;
        }

        .subtask-text {
            font-size: var(--text-sm);
            color: var(--text-primary);
            flex: 1;
            transition: all 0.2s ease;
        }

        .subtask-text.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .delete-subtask-btn {
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            width: 18px;
            height: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            transition: all 0.2s ease;
        }

        .delete-subtask-btn:hover,
        .delete-subtask-btn:focus {
            background: #c53030;
        }

        .add-subtask-container {
            margin-left: var(--space-xl);
            margin-top: var(--space-sm);
            display: none;
        }

        .add-subtask-container.show {
            display: flex;
            gap: var(--space-sm);
        }

        .subtask-input {
            flex: 1;
            padding: var(--space-sm);
            border: 2px solid var(--secondary-color);
            border-radius: var(--radius-md);
            background: white;
            font-size: var(--text-sm);
            outline: none;
        }

        .subtask-input:focus {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-sm);
        }

        .add-subtask-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: var(--space-sm);
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            cursor: pointer;
            min-width: 40px;
        }

        .add-subtask-btn:hover,
        .add-subtask-btn:focus {
            background: var(--primary-color);
        }

        /* Support Panel */
        .support-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: var(--space-2xl);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            z-index: 1000;
            display: none;
        }

        .support-panel.show {
            display: block;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            z-index: 999;
            display: none;
        }

        .modal-overlay.show {
            display: block;
        }

        .hotline-item {
            background: #f7fafc;
            padding: var(--space-lg);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-md);
            border-left: 4px solid var(--primary-color);
        }

        .hotline-name {
            font-size: var(--text-lg);
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: var(--space-sm);
        }

        .hotline-description {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin-bottom: var(--space-md);
            line-height: 1.5;
        }

        .hotline-actions {
            display: flex;
            gap: var(--space-sm);
        }

        .hotline-call,
        .hotline-info {
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
            min-height: 36px;
            display: flex;
            align-items: center;
        }

        .hotline-call {
            background: #48bb78;
            color: white;
        }

        .hotline-call:hover,
        .hotline-call:focus {
            background: #38a169;
        }

        .hotline-info {
            background: #4299e1;
            color: white;
        }

        .hotline-info:hover,
        .hotline-info:focus {
            background: #3182ce;
        }

        .close-modal-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-md);
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            margin-top: var(--space-xl);
            width: 100%;
        }

        .close-modal-btn:hover,
        .close-modal-btn:focus {
            background: var(--secondary-color);
        }

        /* Form Styles */
        .form-container {
            background: rgba(255,255,255,0.95);
            padding: var(--space-xl);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            margin-bottom: var(--space-lg);
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-label {
            display: block;
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: var(--space-sm);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: var(--space-md);
            border: 2px solid rgba(162, 174, 131, 0.3);
            border-radius: var(--radius-md);
            font-size: var(--text-base);
            background: white;
            transition: all 0.2s ease;
            outline: none;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .form-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: var(--space-md) var(--space-xl);
            border-radius: var(--radius-md);
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-md);
            margin-right: var(--space-md);
        }

        .form-btn:hover,
        .form-btn:focus {
            background: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .form-btn.secondary {
            background: var(--text-secondary);
        }

        .form-btn.secondary:hover,
        .form-btn.secondary:focus {
            background: var(--accent-color);
        }

        /* Accessibility */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .spinner {
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (min-width: 640px) {
            .menu-categories {
                grid-template-columns: repeat(2, 1fr);
            }

            .recipe-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .emoji-container {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        @media (min-width: 768px) {
            .home-container {
                flex-direction: row;
                gap: var(--space-2xl);
                align-items: flex-start;
                text-align: left;
            }

            .app-info {
                flex: 1;
            }

            .mood-check,
            .sobriety-tracker {
                max-width: 350px;
            }
        }

        @media (min-width: 1024px) {
            .dashboard-container {
                gap: var(--space-2xl);
            }

            .tab-sidebar {
                min-width: 150px;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --text-primary: #e2e8f0;
                --text-secondary: #a0aec0;
                --surface-color: rgba(255,255,255,0.1);
            }
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            .nav-item {
                border: 2px solid currentColor;
            }

            .task-checkbox,
            .subtask-checkbox {
                border-width: 3px;
            }
        }

        /* Print styles */
        @media print {
            .bottom-nav,
            .support-buttons,
            .form-btn {
                display: none !important;
            }

            body {
                background: white !important;
                color: black !important;
            }

            .page {
                display: block !important;
                overflow: visible !important;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Home Page -->
        <div id="home" class="page active">
            <div class="home-container">
                <div class="app-info">
                    <h1 class="app-title">Hazel</h1>
                    <p class="app-subtitle">Your mental health companion</p>
                </div>

                <!-- Mood Check -->
                <div class="mood-check">
                    <div class="mood-question">How are you feeling today?</div>
                    <div class="emoji-container">
                        <button class="emoji-btn" data-mood="very-happy" aria-label="Very happy">😊</button>
                        <button class="emoji-btn" data-mood="happy" aria-label="Happy">🙂</button>
                        <button class="emoji-btn" data-mood="neutral" aria-label="Neutral">😐</button>
                        <button class="emoji-btn" data-mood="sad" aria-label="Sad">😔</button>
                        <button class="emoji-btn" data-mood="very-sad" aria-label="Very sad">😢</button>
                    </div>
                    
                    <div class="support-section" id="supportSection" style="display: none;">
                        <div class="support-question">Would you like some support?</div>
                        <div class="support-buttons">
                            <button class="support-btn" data-action="resources">Find Resources</button>
                            <button class="support-btn emergency-btn" data-action="crisis" id="emergencyBtn">Crisis Support</button>
                        </div>
                    </div>
                </div>

                <!-- Sobriety Tracker -->
                <div class="sobriety-tracker">
                    <div class="tracker-title">Sobriety Journey</div>
                    <div class="days-sober" id="daysSober">0</div>
                    <div class="sober-label">days strong</div>
                    
                    <div class="progress-section">
                        <div class="progress-label" id="progressLabel">
                            Your journey starts now.
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="milestone-text" id="milestoneText">Next milestone: 7 days</div>
                    </div>

                    <button class="edit-sobriety-btn" id="editSobrietyBtn">Set Start Date</button>
                </div>

                <!-- Streak Display -->
                <div class="streak-container" id="streakContainer" aria-label="Login streak"></div>
            </div>
        </div>

        <!-- Dashboard/Resources Page -->
        <div id="dashboard" class="page">
            <div class="dashboard-container">
                <div class="tab-sidebar">
                    <div class="tab-item active" data-tab="self-harm">SELF HARM</div>
                    <div class="tab-item" data-tab="ed">ED</div>
                    <div class="tab-item" data-tab="anxiety">ANXIETY</div>
                    <div class="tab-item" data-tab="depression">GENERAL</div>
                </div>
                <div class="tab-content" id="tabContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Journal Page -->
        <div id="journal" class="page">
            <div class="journal-header">
                <div class="journal-title">Journal</div>
                <button class="new-entry-btn" id="newEntryBtn">+ New Entry</button>
            </div>
            <div class="journal-entries" id="journalEntries">
                <div class="empty-state">Start writing to track your thoughts and feelings.</div>
            </div>
        </div>

        <!-- Menus Page -->
        <div id="menus" class="page">
            <h2 style="text-align: center; margin-bottom: var(--space-lg); font-size: var(--text-2xl); font-weight: 700; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">Food Menus</h2>
            <div class="menu-categories">
                <div class="menu-category" data-category="breakfast">
                    <div class="category-icon">🥞</div>
                    <div class="category-title">Breakfasts</div>
                </div>
                <div class="menu-category" data-category="lunch">
                    <div class="category-icon">🥗</div>
                    <div class="category-title">Lunches</div>
                </div>
                <div class="menu-category" data-category="dinner">
                    <div class="category-icon">🍽️</div>
                    <div class="category-title">Dinners</div>
                </div>
                <div class="menu-category" data-category="snacks">
                    <div class="category-icon">🍪</div>
                    <div class="category-title">Snacks</div>
                </div>
            </div>
        </div>

        <!-- Recipe List Page -->
        <div id="recipe-list" class="page">
            <div class="recipe-list-container">
                <div class="recipe-header">
                    <button class="back-btn" id="backToMenusBtn" aria-label="Back to menus">←</button>
                    <h2 class="recipe-category-title" id="recipeCategoryTitle">Recipes</h2>
                </div>
                <div class="recipe-grid" id="recipeGrid">
                    <!-- Recipes will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Recipe Detail Page -->
        <div id="recipe-detail" class="page">
            <div class="recipe-detail-container">
                <div class="recipe-detail-header">
                    <button class="back-btn" id="backToRecipeListBtn" aria-label="Back to recipe list">←</button>
                    <h2 class="recipe-detail-title" id="recipeDetailTitle">Recipe</h2>
                </div>
                <div class="recipe-content" id="recipeContent">
                    <!-- Recipe details will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- To-Do List Page -->
        <div id="todo" class="page">
            <div class="todo-container">
                <div class="todo-title">To-Do List</div>
                
                <div class="add-task-container">
                    <input type="text" id="taskInput" class="task-input" placeholder="Add a new task..." maxlength="100" autocomplete="off">
                    <button class="add-btn" id="addTaskBtn">ADD</button>
                </div>

                <div class="tasks-container" id="tasksContainer">
                    <div style="text-align: center; opacity: 0.7; padding: var(--space-xl);">No tasks yet. Add one above!</div>
                </div>
            </div>
        </div>

        <!-- Modal Overlay -->
        <div class="modal-overlay" id="modalOverlay"></div>

        <!-- Support Panel -->
        <div class="support-panel" id="supportPanel">
            <div class="crisis-header">
                <div class="crisis-title">Crisis Support</div>
                <div class="crisis-subtitle">You are not alone. Help is available.</div>
            </div>

            <div class="section-divider"></div>

            <div class="alternatives-list">
                <strong>If you're having thoughts of self-harm, please try these alternatives first:</strong><br>
                • Take 10 deep breaths<br>
                • Hold ice cubes in your hands<br>
                • Draw or write about your feelings
		• Call a friend or family member<br>
                • Listen to calming music<br>
                • Take a warm shower or bath<br>
                • Exercise or go for a walk<br>
                • Practice grounding techniques (5 things you can see, 4 you can hear, etc.)
            </div>

            <div class="hotline-item">
                <div class="hotline-name">National Suicide Prevention Lifeline</div>
                <div class="hotline-description">24/7 crisis support for anyone in suicidal crisis or emotional distress</div>
                <div class="hotline-actions">
                    <button class="hotline-call" data-number="988">Call 988</button>
                    <button class="hotline-info" data-url="https://suicidepreventionlifeline.org">More Info</button>
                </div>
            </div>

            <div class="hotline-item">
                <div class="hotline-name">Crisis Text Line</div>
                <div class="hotline-description">Free, 24/7 support via text message for people in crisis</div>
                <div class="hotline-actions">
                    <button class="hotline-call" data-number="741741">Text HOME to 741741</button>
                    <button class="hotline-info" data-url="https://www.crisistextline.org">More Info</button>
                </div>
            </div>

            <div class="hotline-item">
                <div class="hotline-name">SAMHSA National Helpline</div>
                <div class="hotline-description">Treatment referral and information service for mental health and substance use disorders</div>
                <div class="hotline-actions">
                    <button class="hotline-call" data-number="1-800-662-4357">Call 1-800-662-HELP</button>
                    <button class="hotline-info" data-url="https://www.samhsa.gov/find-help/national-helpline">More Info</button>
                </div>
            </div>

            <div class="hotline-item">
                <div class="hotline-name">National Eating Disorders Association</div>
                <div class="hotline-description">Support for eating disorders and body image concerns</div>
                <div class="hotline-actions">
                    <button class="hotline-call" data-number="1-800-931-2237">Call 1-800-931-2237</button>
                    <button class="hotline-info" data-url="https://www.nationaleatingdisorders.org">More Info</button>
                </div>
            </div>

            <button class="close-modal-btn" id="closeModalBtn">Close</button>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav" role="tablist">
            <div class="nav-item" data-page="menus" role="tab" aria-label="Food menus">
                <div class="nav-icon">🍕</div>
                <div class="nav-text">Menus</div>
            </div>
            <div class="nav-item" data-page="dashboard" role="tab" aria-label="Mental health resources">
                <div class="nav-icon">📊</div>
                <div class="nav-text">Resources</div>
            </div>
            <div class="nav-item active" data-page="home" role="tab" aria-label="Home page">
                <div class="nav-icon">🏠</div>
                <div class="nav-text">Home</div>
            </div>
            <div class="nav-item" data-page="journal" role="tab" aria-label="Journal entries">
                <div class="nav-icon">📖</div>
                <div class="nav-text">Journal</div>
            </div>
            <div class="nav-item" data-page="todo" role="tab" aria-label="To-do list">
                <div class="nav-icon">✅</div>
                <div class="nav-text">To-Do</div>
            </div>
        </nav>

        <!-- Live announcements for screen readers -->
        <div id="live-announcements" aria-live="polite" aria-atomic="true" style="position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;"></div>
    </div>

<script>
    // Generate proper hazelnut icons dynamically
    function createHazelnutIcon(size) {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = size;
        canvas.height = size;
        
        // Background with rounded corners (like Android adaptive icons)
        ctx.fillStyle = '#A2AE83';
        ctx.fillRect(0, 0, size, size);
        
        // Draw hazelnut emoji properly
        ctx.font = `${size * 0.65}px "Segoe UI Emoji", "Noto Color Emoji", "Apple Color Emoji", sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('🌰', size / 2, size / 2);
        
        return canvas.toDataURL('image/png');
    }
    
    // Update manifest with proper icons after page loads
    window.addEventListener('load', () => {
        const icon192 = createHazelnutIcon(192);
        const icon512 = createHazelnutIcon(512);
        
        // Create updated manifest
        const manifest = {
            "name": "Hazel - Mental Health Support",
            "short_name": "Hazel",
            "description": "Mental health support app with journaling, resources, and crisis support",
            "start_url": "./",
            "display": "standalone",
            "orientation": "portrait",
            "background_color": "#A2AE83",
            "theme_color": "#A2AE83",
            "icons": [
                {
                    "src": icon192,
                    "type": "image/png",
                    "sizes": "192x192",
                    "purpose": "any maskable"
                },
                {
                    "src": icon512,
                    "type": "image/png", 
                    "sizes": "512x512",
                    "purpose": "any maskable"
                }
            ],
            "shortcuts": [
                {
                    "name": "New Journal Entry",
                    "short_name": "Journal",
                    "url": "/?action=new-journal"
                },
                {
                    "name": "Crisis Support",
                    "short_name": "Crisis",
                    "url": "/?action=crisis"
                }
            ]
        };
        
        // Replace manifest
        const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        
        const oldManifest = document.querySelector('link[rel="manifest"]');
        if (oldManifest) oldManifest.remove();
        
        const newManifest = document.createElement('link');
        newManifest.rel = 'manifest';
        newManifest.href = manifestURL;
        document.head.appendChild(newManifest);
    });

    // Recipe Data
    const recipeData = {
        breakfast: [
            {
                id: 1,
                title: "Pancakes with Syrup",
                description: "Fluffy buttermilk pancakes served with warm maple syrup and a pat of butter. A comforting breakfast classic that's perfect for weekend mornings.",
                ingredients: [
                    "2 cups all-purpose flour",
                    "2 tablespoons sugar",
                    "2 teaspoons baking powder",
                    "1 teaspoon salt",
                    "2 large eggs",
                    "1 3/4 cups buttermilk",
                    "1/4 cup melted butter",
                    "1 teaspoon vanilla extract",
                    "Butter for cooking",
                    "Maple syrup for serving"
                ],
                method: [
                    "In a large bowl, whisk together flour, sugar, baking powder, and salt.",
                    "In another bowl, beat eggs, then whisk in buttermilk, melted butter, and vanilla.",
                    "Pour wet ingredients into dry ingredients and stir until just combined (don't overmix).",
                    "Heat a non-stick pan or griddle over medium heat and add a little butter.",
                    "Pour 1/4 cup batter for each pancake onto the hot surface.",
                    "Cook until bubbles form on surface and edges look set, about 2-3 minutes.",
                    "Flip and cook until golden brown on the other side, 1-2 minutes.",
                    "Serve immediately with butter and warm maple syrup."
                ]
            },
            {
                id: 2,
                title: "Avocado Toast",
                description: "Creamy mashed avocado on crispy sourdough toast, seasoned with lemon juice, salt, and red pepper flakes. Simple, healthy, and delicious.",
                ingredients: [
                    "2 slices sourdough bread",
                    "1 ripe avocado",
                    "1 tablespoon lemon juice",
                    "Salt and pepper to taste",
                    "Red pepper flakes (optional)",
                    "Optional toppings: cherry tomatoes, feta cheese, everything bagel seasoning"
                ],
                method: [
                    "Toast bread slices until golden brown and crispy.",
                    "Cut avocado in half, remove pit, and scoop flesh into a bowl.",
                    "Add lemon juice, salt, and pepper. Mash with a fork to desired consistency.",
                    "Spread avocado mixture on toast.",
                    "Sprinkle with red pepper flakes and add any additional toppings.",
                    "Serve immediately."
                ]
            },
            {
                id: 3,
                title: "Oatmeal with Berries",
                description: "Warm, creamy steel-cut oats topped with a colorful mix of fresh berries and a drizzle of honey. A comforting, fiber-rich start to your day.",
                ingredients: [
                    "1 cup steel-cut oats",
                    "3 cups water or milk",
                    "1/4 teaspoon salt",
                    "1 cup mixed berries (strawberries, blueberries, raspberries)",
                    "2 tablespoons honey or maple syrup",
                    "Optional toppings: nuts, seeds, cinnamon, yogurt"
                ],
                method: [
                    "In a medium saucepan, bring water or milk to a gentle boil.",
                    "Add oats and salt, reduce heat to low.",
                    "Simmer uncovered for 20-30 minutes, stirring occasionally until oats are tender and creamy.",
                    "Divide into bowls and top with fresh berries.",
                    "Drizzle with honey or maple syrup.",
                    "Add any additional toppings as desired."
                ]
            }
        ],
        lunch: [
            {
                id: 4,
                title: "Chicken Salad",
                description: "Tender grilled chicken breast served on a bed of mixed greens with cherry tomatoes, cucumber, and red onion. Dressed with a light vinaigrette for a satisfying, protein-packed lunch.",
                ingredients: [
                    "2 boneless, skinless chicken breasts",
                    "2 tablespoons olive oil, divided",
                    "1 teaspoon Italian herbs",
                    "Salt and pepper to taste",
                    "4 cups mixed salad greens",
                    "1 cup cherry tomatoes, halved",
                    "1 cucumber, sliced",
                    "1/4 red onion, thinly sliced",
                    "For dressing: 3 tablespoons olive oil, 1 tablespoon balsamic vinegar, 1 teaspoon Dijon mustard, 1 clove garlic (minced), salt and pepper"
                ],
                method: [
                    "Preheat grill or pan to medium-high heat.",
                    "Brush chicken with 1 tablespoon olive oil and season with herbs, salt, and pepper.",
                    "Grill chicken 6-7 minutes per side until cooked through (internal temp 165°F).",
                    "Let chicken rest 5 minutes, then slice.",
                    "Arrange salad greens on plates and top with tomatoes, cucumber, and red onion.",
                    "Add sliced chicken.",
                    "Whisk dressing ingredients and drizzle over salad.",
                    "Serve immediately."
                ]
            },
            {
                id: 5,
                title: "Veggie Wrap",
                description: "A colorful assortment of fresh vegetables and hummus wrapped in a whole wheat tortilla. Perfect for a quick, plant-based lunch on the go.",
                ingredients: [
                    "2 whole wheat tortillas",
                    "1/2 cup hummus",
                    "1 cup baby spinach",
                    "1 carrot, grated",
                    "1 bell pepper, thinly sliced",
                    "1/2 cucumber, cut into thin strips",
                    "1/2 avocado, sliced",
                    "Salt and pepper to taste",
                    "Optional: sprouts, olives, feta cheese"
                ],
                method: [
                    "Warm tortillas slightly to make them more pliable.",
                    "Spread a layer of hummus on each tortilla, leaving a small border around the edge.",
                    "Layer spinach, carrot, bell pepper, cucumber, and avocado on top.",
                    "Season with salt and pepper.",
                    "Add any optional ingredients.",
                    "Fold in sides of tortilla, then roll tightly from bottom to top.",
                    "Cut in half diagonally and serve.",
                    "Can be wrapped in foil for a portable lunch."
                ]
            },
            {
                id: 6,
                title: "Tomato Soup with Grilled Cheese",
                description: "Homemade tomato soup with hints of basil and garlic, served alongside a perfectly golden grilled cheese sandwich. The ultimate comfort food duo.",
                ingredients: [
                    "For soup: 2 tablespoons olive oil, 1 onion (diced), 2 garlic cloves (minced), 2 cans (28oz) whole peeled tomatoes, 2 cups vegetable broth, 1/4 cup fresh basil, 1/4 cup heavy cream, salt and pepper",
                    "For sandwiches: 8 slices bread, 4 tablespoons butter, 8 slices cheese (cheddar, American, or gruyère)"
                ],
                method: [
                    "For soup: Heat oil in pot over medium heat. Add onion and cook until soft.",
                    "Add garlic and cook 30 seconds until fragrant.",
                    "Add tomatoes with juice, broth, and half the basil. Bring to boil, then simmer 15 minutes.",
                    "Blend soup until smooth (use immersion blender or regular blender in batches).",
                    "Return to pot, add cream, salt, and pepper. Warm through.",
                    "For sandwiches: Butter one side of each bread slice.",
                    "Place bread butter-side down, add cheese, top with another slice butter-side up.",
                    "Cook in skillet over medium heat until golden and cheese melts, about 3-4 minutes per side.",
                    "Garnish soup with remaining basil and serve with grilled cheese."
                ]
            }
        ],
        dinner: [
            {
                id: 7,
                title: "Spaghetti Bolognese",
                description: "Al dente spaghetti topped with a rich, slow-simmered meat sauce. This classic Italian comfort food is hearty, satisfying, and perfect for family meals.",
                ingredients: [
                    "1 pound spaghetti",
                    "2 tablespoons olive oil",
                    "1 pound ground beef (or mix of beef and pork)",
                    "1 onion, finely diced",
                    "2 carrots, finely diced",
                    "2 celery stalks, finely diced",
                    "4 garlic cloves, minced",
                    "1 can (28oz) crushed tomatoes",
                    "1/2 cup red wine (optional)",
                    "2 tablespoons tomato paste",
                    "1 teaspoon dried oregano",
                    "1 teaspoon dried basil",
                    "Salt and pepper to taste",
                    "Parmesan cheese for serving"
                ],
                method: [
                    "Heat olive oil in a large pot over medium-high heat.",
                    "Add ground meat and cook, breaking it up, until browned (about 5-7 minutes).",
                    "Add onion, carrots, and celery. Cook until vegetables soften, about 5 minutes.",
                    "Add garlic and cook 1 minute until fragrant.",
                    "Stir in tomato paste and cook 1 minute.",
                    "Add wine (if using) and let it simmer for 2 minutes.",
                    "Add crushed tomatoes, oregano, basil, salt, and pepper.",
                    "Reduce heat to low and simmer for 30-45 minutes, stirring occasionally.",
                    "Meanwhile, cook spaghetti according to package directions until al dente.",
                    "Serve sauce over pasta with grated Parmesan cheese."
                ]
            },
            {
                id: 8,
                title: "Baked Salmon with Vegetables",
                description: "Tender baked salmon fillet seasoned with herbs and lemon, served with a medley of roasted seasonal vegetables. A healthy, complete meal.",
                ingredients: [
                    "4 salmon fillets (6oz each)",
                    "2 tablespoons olive oil",
                    "2 lemons (juiced and zested)",
                    "2 teaspoons dried dill",
                    "1 teaspoon garlic powder",
                    "Salt and pepper to taste",
                    "2 cups broccoli florets",
                    "1 bell pepper, sliced",
                    "1 zucchini, sliced",
                    "1 red onion, sliced",
                    "2 tablespoons fresh herbs (parsley, dill, or thyme)"
                ],
                method: [
                    "Preheat oven to 425°F (220°C).",
                    "Line a large baking sheet with parchment paper.",
                    "Place salmon fillets on one side of the baking sheet.",
                    "Brush salmon with half the olive oil and season with lemon juice, zest, dill, garlic powder, salt, and pepper.",
                    "Toss vegetables with remaining olive oil, salt, and pepper.",
                    "Arrange vegetables on the other side of the baking sheet.",
                    "Bake for 12-15 minutes until salmon flakes easily and vegetables are tender.",
                    "Garnish with fresh herbs and serve with lemon wedges."
                ]
            },
            {
                id: 9,
                title: "Vegetable Stir Fry",
                description: "A colorful mix of fresh vegetables quickly stir-fried and tossed in a savory sauce. Served over steamed rice for a satisfying vegetarian meal.",
                ingredients: [
                    "2 tablespoons vegetable oil",
                    "1 onion, sliced",
                    "2 bell peppers, sliced",
                    "1 cup broccoli florets",
                    "1 cup snap peas",
                    "2 carrots, thinly sliced",
                    "3 garlic cloves, minced",
                    "1 tablespoon fresh ginger, minced",
                    "For sauce: 3 tablespoons soy sauce, 2 tablespoons oyster sauce, 1 tablespoon rice vinegar, 1 teaspoon sesame oil, 1 teaspoon cornstarch",
                    "Cooked rice for serving",
                    "Sesame seeds and green onions for garnish"
                ],
                method: [
                    "Mix all sauce ingredients in a small bowl and set aside.",
                    "Heat oil in a large wok or skillet over high heat.",
                    "Add onion and stir-fry for 2 minutes.",
                    "Add bell peppers, broccoli, and carrots. Stir-fry for 3-4 minutes.",
                    "Add snap peas, garlic, and ginger. Stir-fry for 1-2 minutes.",
                    "Pour sauce over vegetables and toss to coat.",
                    "Cook for 1-2 minutes until sauce thickens.",
                    "Serve immediately over rice, garnished with sesame seeds and green onions."
                ]
            }
        ],
        snacks: [
            {
                id: 10,
                title: "Trail Mix",
                description: "A healthy mix of nuts, dried fruits, and seeds. Perfect for on-the-go snacking or post-workout fuel.",
                ingredients: [
                    "1 cup mixed nuts (almonds, cashews, walnuts)",
                    "1/2 cup dried fruits (raisins, cranberries, apricots)",
                    "1/4 cup seeds (pumpkin seeds, sunflower seeds)",
                    "1/4 cup dark chocolate chips (optional)"
                ],
                method: [
                    "Combine all ingredients in a large bowl.",
                    "Mix well to distribute evenly.",
                    "Store in an airtight container for up to 2 weeks.",
                    "Portion into small bags for easy grab-and-go snacks."
                ]
            },
            {
                id: 11,
                title: "Apple Slices with Peanut Butter",
                description: "Crisp apple slices paired with creamy peanut butter. A simple, nutritious snack that provides fiber, protein, and healthy fats.",
                ingredients: [
                    "2 medium apples, cored and sliced",
                    "1/4 cup natural peanut butter",
                    "Optional: cinnamon, honey, crushed nuts"
                ],
                method: [
                    "Wash and core apples, then slice into wedges.",
                    "Arrange apple slices on a plate.",
                    "Serve with peanut butter for dipping.",
                    "Sprinkle with cinnamon or drizzle with honey if desired.",
                    "Can also sprinkle crushed nuts on peanut butter for extra crunch."
                ]
            },
            {
                id: 12,
                title: "Greek Yogurt Parfait",
                description: "Layers of creamy Greek yogurt, fresh berries, and crunchy granola. A protein-rich snack that feels like a treat.",
                ingredients: [
                    "1 cup Greek yogurt",
                    "1/2 cup mixed berries",
                    "1/4 cup granola",
                    "1 tablespoon honey",
                    "Optional: nuts, seeds, coconut flakes"
                ],
                method: [
                    "In a glass or bowl, layer half the yogurt.",
                    "Add half the berries and a drizzle of honey.",
                    "Add half the granola.",
                    "Repeat layers with remaining ingredients.",
                    "Top with any optional ingredients.",
                    "Serve immediately for best texture."
                ]
            }
        ]
    };

        // Enhanced PWA App with Mobile-First Features and Fullscreen Support
        class HazelApp {
            constructor() {
                this.currentPage = 'home';
                this.currentCategory = null;
                this.currentRecipe = null;
                this.journalEntries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
                this.streak = parseInt(localStorage.getItem('streak') || '0');
                this.lastLoginDate = localStorage.getItem('lastLoginDate');
                this.sobrietyStartDate = localStorage.getItem('sobrietyStartDate');
                this.tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
                this.nextTaskId = parseInt(localStorage.getItem('nextTaskId') || '1');
                this.nextSubtaskId = parseInt(localStorage.getItem('nextSubtaskId') || '1');
                this.selectedMood = null;
                this.deferredPrompt = null;
                this.isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
                
                this.init();
            }

init() {
                this.registerServiceWorker();
                this.setupEventListeners();
                this.setupTouchEnhancements();
                this.setupAccessibility();
                this.loadInitialData();
                this.handleInstallPrompt();
                this.checkStreak();
                this.loadSobrietyProgress();
                this.loadTasks();
                this.loadJournalEntries();
                this.showTabContent('self-harm');
                
                // PWA installation prompt handling
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    this.deferredPrompt = e;
                    console.log('PWA install prompt saved');
                });

                // Handle URL parameters for shortcuts
                const urlParams = new URLSearchParams(window.location.search);
                const action = urlParams.get('action');
                if (action) {
                    this.handleShortcutAction(action);
                }

                // Handle fullscreen mode changes
                document.addEventListener('fullscreenchange', () => {
                    if (document.fullscreenElement) {
                        document.body.classList.add('fullscreen-mode');
                    } else {
                        document.body.classList.remove('fullscreen-mode');
                    }
                });
            }

            // Navigation
            navigateTo(page) {
                // Hide all pages
                document.querySelectorAll('.page').forEach(p => {
                    p.classList.remove('active');
                });
                
                // Show target page
                const targetPage = document.getElementById(page);
                if (targetPage) {
                    targetPage.classList.add('active');
                    this.currentPage = page;
                }
                
                // Update navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const activeNavItem = document.querySelector(`[data-page="${page}"]`);
                if (activeNavItem) {
                    activeNavItem.classList.add('active');
                }
                
                this.announce(`Navigated to ${page}`);
            }

            // Show specific recipe category
            showRecipeCategory(category) {
                this.currentCategory = category;
                const recipes = recipeData[category] || [];
                
                // Update category title
                const categoryTitle = document.getElementById('recipeCategoryTitle');
                if (categoryTitle) {
                    categoryTitle.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                }
                
                // Populate recipe grid
                const recipeGrid = document.getElementById('recipeGrid');
                if (recipeGrid) {
                    recipeGrid.innerHTML = recipes.map(recipe => `
                        <div class="recipe-card" data-recipe-id="${recipe.id}">
                            <div class="recipe-title">${recipe.title}</div>
                            <div class="recipe-description">${recipe.description}</div>
                        </div>
                    `).join('');
                    
                    // Add click handlers
                    recipeGrid.querySelectorAll('.recipe-card').forEach(card => {
                        card.addEventListener('click', () => {
                            const recipeId = parseInt(card.dataset.recipeId);
                            this.showRecipeDetail(recipeId);
                        });
                    });
                }
                
                // Navigate to recipe list page
                this.navigateTo('recipe-list');
            }

            // Show recipe details
            showRecipeDetail(recipeId) {
                const recipe = this.findRecipeById(recipeId);
                if (!recipe) return;
                
                this.currentRecipe = recipe;
                
                // Update recipe title
                const recipeTitle = document.getElementById('recipeDetailTitle');
                if (recipeTitle) {
                    recipeTitle.textContent = recipe.title;
                }
                
                // Populate recipe content
                const recipeContent = document.getElementById('recipeContent');
                if (recipeContent) {
                    recipeContent.innerHTML = `
                        <div class="recipe-section">
                            <h3 class="recipe-section-title">${recipe.title}</h3>
                            <p style="color: var(--text-secondary); font-size: var(--text-base); line-height: 1.6; margin-bottom: var(--space-lg);">${recipe.description}</p>
                        </div>
                        
                        <div class="recipe-section">
                            <h3 class="recipe-section-title">Ingredients</h3>
                            <ul class="ingredients-list">
                                ${recipe.ingredients.map(ingredient => `<li>${ingredient}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="recipe-section">
                            <h3 class="recipe-section-title">Method</h3>
                            <ol class="method-list">
                                ${recipe.method.map(step => `<li>${step}</li>`).join('')}
                            </ol>
                        </div>
                    `;
                }
                
                // Navigate to recipe detail page
                this.navigateTo('recipe-detail');
            }

            // Find recipe by ID across all categories
            findRecipeById(id) {
                for (const category in recipeData) {
                    const recipe = recipeData[category].find(r => r.id === id);
                    if (recipe) return recipe;
                }
                return null;
            }

            // Task Management with Subtasks
            loadTasks() {
                const container = document.getElementById('tasksContainer');
                
                if (this.tasks.length === 0) {
                    container.innerHTML = '<div style="text-align: center; opacity: 0.7; padding: var(--space-xl);">No tasks yet. Add one above!</div>';
                    return;
                }
                
                container.innerHTML = this.tasks.map(task => `
                    <div class="task-item">
                        <div class="task-checkbox ${task.completed ? 'completed' : ''}" data-task-id="${task.id}"></div>
                        <div class="task-content">
                            <div class="task-text ${task.completed ? 'completed' : ''}">${task.text}</div>
                            ${task.subtasks && task.subtasks.length > 0 ? this.renderSubtasks(task.subtasks) : ''}
                            <div class="add-subtask-container" id="addSubtask-${task.id}">
                                <input type="text" class="subtask-input" placeholder="Add a subtask..." maxlength="80">
                                <button class="add-subtask-btn" data-task-id="${task.id}">+</button>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="subtask-btn" data-task-id="${task.id}">+Sub</button>
                            <button class="delete-task-btn" data-task-id="${task.id}">×</button>
                        </div>
                    </div>
                `).join('');
                
                // Add event listeners
                container.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('click', () => {
                        this.toggleTask(parseInt(checkbox.dataset.taskId));
                    });
                });

                container.querySelectorAll('.subtask-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.toggleSubtaskForm(parseInt(btn.dataset.taskId));
                    });
                });

                container.querySelectorAll('.add-subtask-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.addSubtask(parseInt(btn.dataset.taskId));
                    });
                });

                container.querySelectorAll('.delete-task-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.deleteTask(parseInt(btn.dataset.taskId));
                    });
                });

                container.querySelectorAll('.subtask-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('click', () => {
                        this.toggleSubtask(parseInt(checkbox.dataset.taskId), parseInt(checkbox.dataset.subtaskId));
                    });
                });

                container.querySelectorAll('.delete-subtask-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.deleteSubtask(parseInt(btn.dataset.taskId), parseInt(btn.dataset.subtaskId));
                    });
                });

                // Handle Enter key for subtask inputs
                container.querySelectorAll('.subtask-input').forEach(input => {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            const taskId = parseInt(e.target.closest('.add-subtask-container').querySelector('.add-subtask-btn').dataset.taskId);
                            this.addSubtask(taskId);
                        }
                    });
                });
            }

            renderSubtasks(subtasks) {
                return `
                    <div class="subtasks-container">
                        ${subtasks.map(subtask => `
                            <div class="subtask-item">
                                <div class="subtask-checkbox ${subtask.completed ? 'completed' : ''}" 
                                     data-task-id="${subtask.taskId}" 
                                     data-subtask-id="${subtask.id}"></div>
                                <div class="subtask-text ${subtask.completed ? 'completed' : ''}">${subtask.text}</div>
                                <button class="delete-subtask-btn" 
                                        data-task-id="${subtask.taskId}" 
                                        data-subtask-id="${subtask.id}">×</button>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            addTask() {
                const input = document.getElementById('taskInput');
                const text = input.value.trim();
                
                if (!text) return;
                
                const task = {
                    id: this.nextTaskId++,
                    text: text,
                    completed: false,
                    createdAt: new Date().toISOString(),
                    subtasks: []
                };
                
                this.tasks.push(task);
                this.saveTasks();
                
                input.value = '';
                this.loadTasks();
                this.announce('Task added');
            }

            toggleTask(id) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.completed = !task.completed;
                    // If task is completed, mark all subtasks as completed
                    if (task.completed && task.subtasks) {
                        task.subtasks.forEach(subtask => subtask.completed = true);
                    }
                    this.saveTasks();
                    this.loadTasks();
                    this.announce(task.completed ? 'Task completed' : 'Task uncompleted');
                }
            }

            deleteTask(id) {
                this.tasks = this.tasks.filter(t => t.id !== id);
                this.saveTasks();
                this.loadTasks();
                this.announce('Task deleted');
            }

            toggleSubtaskForm(taskId) {
                const container = document.getElementById(`addSubtask-${taskId}`);
                if (container) {
                    container.classList.toggle('show');
                    if (container.classList.contains('show')) {
                        const input = container.querySelector('.subtask-input');
                        if (input) input.focus();
                    }
                }
            }

            addSubtask(taskId) {
                const container = document.getElementById(`addSubtask-${taskId}`);
                const input = container?.querySelector('.subtask-input');
                const text = input?.value.trim();
                
                if (!text) return;
                
                const task = this.tasks.find(t => t.id === taskId);
                if (task) {
                    if (!task.subtasks) task.subtasks = [];
                    
                    const subtask = {
                        id: this.nextSubtaskId++,
                        taskId: taskId,
                        text: text,
                        completed: false,
                        createdAt: new Date().toISOString()
                    };
                    
                    task.subtasks.push(subtask);
                    this.saveTasks();
                    
                    input.value = '';
                    container.classList.remove('show');
                    this.loadTasks();
                    this.announce('Subtask added');
                }
            }

            toggleSubtask(taskId, subtaskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (task && task.subtasks) {
                    const subtask = task.subtasks.find(s => s.id === subtaskId);
                    if (subtask) {
                        subtask.completed = !subtask.completed;
                        
                        // Check if all subtasks are completed and update main task
                        const allSubtasksCompleted = task.subtasks.every(s => s.completed);
                        const anySubtasksCompleted = task.subtasks.some(s => s.completed);
                        
                        if (allSubtasksCompleted && task.subtasks.length > 0) {
                            task.completed = true;
                        } else if (!anySubtasksCompleted) {
                            task.completed = false;
                        }
                        
                        this.saveTasks();
                        this.loadTasks();
                        this.announce(subtask.completed ? 'Subtask completed' : 'Subtask uncompleted');
                    }
                }
            }

            deleteSubtask(taskId, subtaskId) {
                const task = this.tasks.find(t => t.id === taskId);
                if (task && task.subtasks) {
                    task.subtasks = task.subtasks.filter(s => s.id !== subtaskId);
                    this.saveTasks();
                    this.loadTasks();
                    this.announce('Subtask deleted');
                }
            }

            saveTasks() {
                localStorage.setItem('tasks', JSON.stringify(this.tasks));
                localStorage.setItem('nextTaskId', this.nextTaskId.toString());
                localStorage.setItem('nextSubtaskId', this.nextSubtaskId.toString());
            }

            // Mood Handling
            handleMoodSelect(mood) {
                this.selectedMood = mood;
                
                // Update visual selection
                document.querySelectorAll('.emoji-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                const selectedBtn = document.querySelector(`[data-mood="${mood}"]`);
                if (selectedBtn) {
                    selectedBtn.classList.add('selected');
                }
                
                // Show support section for negative moods
                const supportSection = document.getElementById('supportSection');
                if (['sad', 'very-sad'].includes(mood)) {
                    supportSection.style.display = 'block';
                } else {
                    supportSection.style.display = 'none';
                }
                
                this.announce(`Selected mood: ${mood.replace('-', ' ')}`);
            }

            // Support Actions
            handleSupportAction(action) {
                switch(action) {
                    case 'resources':
                        this.navigateTo('dashboard');
                        break;
                    case 'crisis':
                        this.showHotlines();
                        break;
                }
            }

            showHotlines() {
                const modal = document.getElementById('supportPanel');
                const overlay = document.getElementById('modalOverlay');
                
                modal.classList.add('show');
                overlay.classList.add('show');
                
                // Focus management for accessibility
                const closeBtn = document.getElementById('closeModalBtn');
                if (closeBtn) closeBtn.focus();
            }

            hideModal() {
                const modal = document.getElementById('supportPanel');
                const overlay = document.getElementById('modalOverlay');
                
                modal.classList.remove('show');
                overlay.classList.remove('show');
            }
setupTouchEnhancements() {
                // Prevent double-tap zoom
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function (event) {
                    const now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);

                // Prevent pinch zoom
                document.addEventListener('gesturestart', (e) => {
                    e.preventDefault();
                });

                document.addEventListener('gesturechange', (e) => {
                    e.preventDefault();
                });

                document.addEventListener('gestureend', (e) => {
                    e.preventDefault();
                });

                // Add touch ripple effects to buttons
                document.querySelectorAll('.emoji-btn, .btn, .nav-item, .menu-category, .recipe-card').forEach(el => {
                    el.addEventListener('touchstart', (e) => {
                        el.style.transform = 'scale(0.98)';
                    });
                    
                    el.addEventListener('touchend', (e) => {
                        setTimeout(() => {
                            el.style.transform = '';
                        }, 150);
                    });
                });
            }

            setupAccessibility() {
                // Keyboard navigation for tabs
                document.addEventListener('keydown', (e) => {
                    if (e.target.classList.contains('nav-item')) {
                        const navItems = Array.from(document.querySelectorAll('.nav-item'));
                        const currentIndex = navItems.indexOf(e.target);
                        let nextIndex;
                        
                        if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                            nextIndex = currentIndex > 0 ? currentIndex - 1 : navItems.length - 1;
                        } else if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                            nextIndex = currentIndex < navItems.length - 1 ? currentIndex + 1 : 0;
                        } else if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            this.navigateTo(e.target.dataset.page);
                            return;
                        }
                        
                        if (nextIndex !== undefined) {
                            e.preventDefault();
                            navItems[nextIndex].focus();
                        }
                    }
                });

                // Skip to main content
                const skipLink = document.createElement('a');
                skipLink.href = '#main';
                skipLink.textContent = 'Skip to main content';
                skipLink.className = 'visually-hidden';
                skipLink.addEventListener('focus', () => {
                    skipLink.classList.remove('visually-hidden');
                });
                skipLink.addEventListener('blur', () => {
                    skipLink.classList.add('visually-hidden');
                });
                document.body.prepend(skipLink);

                // Add main landmark
                const appContainer = document.querySelector('.app-container');
                if (appContainer) {
                    appContainer.setAttribute('role', 'main');
                    appContainer.id = 'main';
                }
            }

            showUpdateNotification() {
                const notification = document.createElement('div');
                notification.className = 'update-notification';
                notification.innerHTML = `
                    <div style="background: var(--primary-color); color: white; padding: var(--space-md); border-radius: var(--radius-md); margin: var(--space-md); text-align: center;">
                        App update available!
                        <button onclick="window.location.reload()" style="background: white; color: var(--primary-color); border: none; padding: var(--space-sm); border-radius: var(--radius-sm); margin-left: var(--space-sm); cursor: pointer;">
                            Update Now
                        </button>
                    </div>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 5000);
            }
        }

        // Initialize the app when DOM is loaded
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new HazelApp();
        });

        // Handle app lifecycle events
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && app) {
                // App became visible, check for updates
                app.checkStreak();
            }
        });

        // Handle install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            if (app) {
                app.deferredPrompt = e;
            }
        });

        // Handle successful installation
        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
            if (app) {
                app.announce('App installed successfully!');
            }
        });

        // Handle offline/online status
        window.addEventListener('online', () => {
            if (app) {
                app.announce('Back online');
            }
        });

        window.addEventListener('offline', () => {
            if (app) {
                app.announce('You are offline');
            }
        });

        // Error handling
        window.addEventListener('error', (e) => {
            console.error('Global error:', e.error);
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled promise rejection:', e.reason);
        });
    </script>
</body>
</html>
